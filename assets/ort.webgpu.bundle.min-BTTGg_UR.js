var Ol=Object.defineProperty;var Il=(n,a,l)=>a in n?Ol(n,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[a]=l;var Xi=(n,a,l)=>Il(n,typeof a!="symbol"?a+"":a,l);/*!
 * ONNX Runtime Web v1.23.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var sn=Object.defineProperty,Sl=Object.getOwnPropertyDescriptor,Ul=Object.getOwnPropertyNames,Bl=Object.prototype.hasOwnProperty,Rl=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(a,l)=>(typeof require<"u"?require:a)[l]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')}),$=(n,a)=>()=>(n&&(a=n(n=0)),a),Rt=(n,a)=>{for(var l in a)sn(n,l,{get:a[l],enumerable:!0})},Ml=(n,a,l,f)=>{if(a&&typeof a=="object"||typeof a=="function")for(let u of Ul(a))!Bl.call(n,u)&&u!==l&&sn(n,u,{get:()=>a[u],enumerable:!(f=Sl(a,u))||f.enumerable});return n},Kt=n=>Ml(sn({},"__esModule",{value:!0}),n),xt,qe,ht,Yi,Ta,_a=$(()=>{xt=new Map,qe=[],ht=(n,a,l)=>{if(a&&typeof a.init=="function"&&typeof a.createInferenceSessionHandler=="function"){let f=xt.get(n);if(f===void 0)xt.set(n,{backend:a,priority:l});else{if(f.priority>l)return;if(f.priority===l&&f.backend!==a)throw new Error(`cannot register backend "${n}" using priority ${l}`)}if(l>=0){let u=qe.indexOf(n);u!==-1&&qe.splice(u,1);for(let i=0;i<qe.length;i++)if(xt.get(qe[i]).priority<=l){qe.splice(i,0,n);return}qe.push(n)}return}throw new TypeError("not a valid backend")},Yi=async n=>{let a=xt.get(n);if(!a)return"backend not found.";if(a.initialized)return a.backend;if(a.aborted)return a.error;{let l=!!a.initPromise;try{return l||(a.initPromise=a.backend.init(n)),await a.initPromise,a.initialized=!0,a.backend}catch(f){return l||(a.error=`${f}`,a.aborted=!0),a.error}finally{delete a.initPromise}}},Ta=async n=>{let a=n.executionProviders||[],l=a.map(m=>typeof m=="string"?m:m.name),f=l.length===0?qe:l,u,i=[],p=new Set;for(let m of f){let y=await Yi(m);typeof y=="string"?i.push({name:m,err:y}):(u||(u=y),u===y&&p.add(m))}if(!u)throw new Error(`no available backend found. ERR: ${i.map(m=>`[${m.name}] ${m.err}`).join(", ")}`);for(let{name:m,err:y}of i)l.includes(m)&&console.warn(`removing requested execution provider "${m}" from session options because it is not available: ${y}`);let h=a.filter(m=>p.has(typeof m=="string"?m:m.name));return[u,new Proxy(n,{get:(m,y)=>y==="executionProviders"?h:Reflect.get(m,y)})]}}),Ll=$(()=>{_a()}),Ea,jl=$(()=>{Ea="1.23.2"}),Rr,ae,xa=$(()=>{jl(),Rr="warning",ae={wasm:{},webgl:{},webgpu:{},versions:{common:Ea},set logLevel(n){if(n!==void 0){if(typeof n!="string"||["verbose","info","warning","error","fatal"].indexOf(n)===-1)throw new Error(`Unsupported logging level: ${n}`);Rr=n}},get logLevel(){return Rr}},Object.defineProperty(ae,"logLevel",{enumerable:!0})}),K,Pl=$(()=>{xa(),K=ae}),Aa,Oa,$l=$(()=>{Aa=(n,a)=>{let l=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);l.width=n.dims[3],l.height=n.dims[2];let f=l.getContext("2d");if(f!=null){let u,i;(a==null?void 0:a.tensorLayout)!==void 0&&a.tensorLayout==="NHWC"?(u=n.dims[2],i=n.dims[3]):(u=n.dims[3],i=n.dims[2]);let p=(a==null?void 0:a.format)!==void 0?a.format:"RGB",h=a==null?void 0:a.norm,m,y;h===void 0||h.mean===void 0?m=[255,255,255,255]:typeof h.mean=="number"?m=[h.mean,h.mean,h.mean,h.mean]:(m=[h.mean[0],h.mean[1],h.mean[2],0],h.mean[3]!==void 0&&(m[3]=h.mean[3])),h===void 0||h.bias===void 0?y=[0,0,0,0]:typeof h.bias=="number"?y=[h.bias,h.bias,h.bias,h.bias]:(y=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(y[3]=h.bias[3]));let v=i*u,C=0,E=v,O=v*2,M=-1;p==="RGBA"?(C=0,E=v,O=v*2,M=v*3):p==="RGB"?(C=0,E=v,O=v*2):p==="RBG"&&(C=0,O=v,E=v*2);for(let j=0;j<i;j++)for(let N=0;N<u;N++){let R=(n.data[C++]-y[0])*m[0],S=(n.data[E++]-y[1])*m[1],z=(n.data[O++]-y[2])*m[2],q=M===-1?255:(n.data[M++]-y[3])*m[3];f.fillStyle="rgba("+R+","+S+","+z+","+q+")",f.fillRect(N,j,1,1)}if("toDataURL"in l)return l.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Oa=(n,a)=>{let l=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),f;if(l!=null){let u,i,p;(a==null?void 0:a.tensorLayout)!==void 0&&a.tensorLayout==="NHWC"?(u=n.dims[2],i=n.dims[1],p=n.dims[3]):(u=n.dims[3],i=n.dims[2],p=n.dims[1]);let h=a!==void 0&&a.format!==void 0?a.format:"RGB",m=a==null?void 0:a.norm,y,v;m===void 0||m.mean===void 0?y=[255,255,255,255]:typeof m.mean=="number"?y=[m.mean,m.mean,m.mean,m.mean]:(y=[m.mean[0],m.mean[1],m.mean[2],255],m.mean[3]!==void 0&&(y[3]=m.mean[3])),m===void 0||m.bias===void 0?v=[0,0,0,0]:typeof m.bias=="number"?v=[m.bias,m.bias,m.bias,m.bias]:(v=[m.bias[0],m.bias[1],m.bias[2],0],m.bias[3]!==void 0&&(v[3]=m.bias[3]));let C=i*u;if(a!==void 0&&(a.format!==void 0&&p===4&&a.format!=="RGBA"||p===3&&a.format!=="RGB"&&a.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let E=4,O=0,M=1,j=2,N=3,R=0,S=C,z=C*2,q=-1;h==="RGBA"?(R=0,S=C,z=C*2,q=C*3):h==="RGB"?(R=0,S=C,z=C*2):h==="RBG"&&(R=0,z=C,S=C*2),f=l.createImageData(u,i);for(let Q=0;Q<i*u;O+=E,M+=E,j+=E,N+=E,Q++)f.data[O]=(n.data[R++]-v[0])*y[0],f.data[M]=(n.data[S++]-v[1])*y[1],f.data[j]=(n.data[z++]-v[2])*y[2],f.data[N]=q===-1?255:(n.data[q++]-v[3])*y[3]}else throw new Error("Can not access image data");return f}}),zt,Ia,Sa,Ua,Ba,Ra,kl=$(()=>{ln(),zt=(n,a)=>{if(n===void 0)throw new Error("Image buffer must be defined");if(a.height===void 0||a.width===void 0)throw new Error("Image height and width must be defined");if(a.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:l,width:f}=a,u=a.norm??{mean:255,bias:0},i,p;typeof u.mean=="number"?i=[u.mean,u.mean,u.mean,u.mean]:i=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?p=[u.bias,u.bias,u.bias,u.bias]:p=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let h=a.format!==void 0?a.format:"RGBA",m=a.tensorFormat!==void 0&&a.tensorFormat!==void 0?a.tensorFormat:"RGB",y=l*f,v=m==="RGBA"?new Float32Array(y*4):new Float32Array(y*3),C=4,E=0,O=1,M=2,j=3,N=0,R=y,S=y*2,z=-1;h==="RGB"&&(C=3,E=0,O=1,M=2,j=-1),m==="RGBA"?z=y*3:m==="RBG"?(N=0,S=y,R=y*2):m==="BGR"&&(S=0,R=y,N=y*2);for(let q=0;q<y;q++,E+=C,M+=C,O+=C,j+=C)v[N++]=(n[E]+p[0])/i[0],v[R++]=(n[O]+p[1])/i[1],v[S++]=(n[M]+p[2])/i[2],z!==-1&&j!==-1&&(v[z++]=(n[j]+p[3])/i[3]);return m==="RGBA"?new Ce("float32",v,[1,4,l,f]):new Ce("float32",v,[1,3,l,f])},Ia=async(n,a)=>{let l=typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement,f=typeof ImageData<"u"&&n instanceof ImageData,u=typeof ImageBitmap<"u"&&n instanceof ImageBitmap,i=typeof n=="string",p,h=a??{},m=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},y=v=>typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||v instanceof OffscreenCanvas?v.getContext("2d"):null;if(l){let v=m();v.width=n.width,v.height=n.height;let C=y(v);if(C!=null){let E=n.height,O=n.width;if(a!==void 0&&a.resizedHeight!==void 0&&a.resizedWidth!==void 0&&(E=a.resizedHeight,O=a.resizedWidth),a!==void 0){if(h=a,a.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");h.tensorFormat="RGBA",h.height=E,h.width=O}else h.tensorFormat="RGBA",h.height=E,h.width=O;C.drawImage(n,0,0),p=C.getImageData(0,0,O,E).data}else throw new Error("Can not access image data")}else if(f){let v,C;if(a!==void 0&&a.resizedWidth!==void 0&&a.resizedHeight!==void 0?(v=a.resizedHeight,C=a.resizedWidth):(v=n.height,C=n.width),a!==void 0&&(h=a),h.format="RGBA",h.height=v,h.width=C,a!==void 0){let E=m();E.width=C,E.height=v;let O=y(E);if(O!=null)O.putImageData(n,0,0),p=O.getImageData(0,0,C,v).data;else throw new Error("Can not access image data")}else p=n.data}else if(u){if(a===void 0)throw new Error("Please provide image config with format for Imagebitmap");let v=m();v.width=n.width,v.height=n.height;let C=y(v);if(C!=null){let E=n.height,O=n.width;return C.drawImage(n,0,0,O,E),p=C.getImageData(0,0,O,E).data,h.height=E,h.width=O,zt(p,h)}else throw new Error("Can not access image data")}else{if(i)return new Promise((v,C)=>{let E=m(),O=y(E);if(!n||!O)return C();let M=new Image;M.crossOrigin="Anonymous",M.src=n,M.onload=()=>{E.width=M.width,E.height=M.height,O.drawImage(M,0,0,E.width,E.height);let j=O.getImageData(0,0,E.width,E.height);h.height=E.height,h.width=E.width,v(zt(j.data,h))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(p!==void 0)return zt(p,h);throw new Error("Input data provided is not supported - aborted tensor creation")},Sa=(n,a)=>{let{width:l,height:f,download:u,dispose:i}=a,p=[1,f,l,4];return new Ce({location:"texture",type:"float32",texture:n,dims:p,download:u,dispose:i})},Ua=(n,a)=>{let{dataType:l,dims:f,download:u,dispose:i}=a;return new Ce({location:"gpu-buffer",type:l??"float32",gpuBuffer:n,dims:f,download:u,dispose:i})},Ba=(n,a)=>{let{dataType:l,dims:f,download:u,dispose:i}=a;return new Ce({location:"ml-tensor",type:l??"float32",mlTensor:n,dims:f,download:u,dispose:i})},Ra=(n,a,l)=>new Ce({location:"cpu-pinned",type:n,data:a,dims:l??[a.length]})}),tt,Ut,Mr,Ma,Dl=$(()=>{tt=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Ut=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Mr=!1,Ma=()=>{if(!Mr){Mr=!0;let n=typeof BigInt64Array<"u"&&BigInt64Array.from,a=typeof BigUint64Array<"u"&&BigUint64Array.from,l=globalThis.Float16Array,f=typeof l<"u"&&l.from;n&&(tt.set("int64",BigInt64Array),Ut.set(BigInt64Array,"int64")),a&&(tt.set("uint64",BigUint64Array),Ut.set(BigUint64Array,"uint64")),f?(tt.set("float16",l),Ut.set(l,"float16")):tt.set("float16",Uint16Array)}}}),La,ja,Nl=$(()=>{ln(),La=n=>{let a=1;for(let l=0;l<n.length;l++){let f=n[l];if(typeof f!="number"||!Number.isSafeInteger(f))throw new TypeError(`dims[${l}] must be an integer, got: ${f}`);if(f<0)throw new RangeError(`dims[${l}] must be a non-negative integer, got: ${f}`);a*=f}return a},ja=(n,a)=>{switch(n.location){case"cpu":return new Ce(n.type,n.data,a);case"cpu-pinned":return new Ce({location:"cpu-pinned",data:n.data,type:n.type,dims:a});case"texture":return new Ce({location:"texture",texture:n.texture,type:n.type,dims:a});case"gpu-buffer":return new Ce({location:"gpu-buffer",gpuBuffer:n.gpuBuffer,type:n.type,dims:a});case"ml-tensor":return new Ce({location:"ml-tensor",mlTensor:n.mlTensor,type:n.type,dims:a});default:throw new Error(`tensorReshape: tensor location ${n.location} is not supported`)}}}),Ce,ln=$(()=>{$l(),kl(),Dl(),Nl(),Ce=class{constructor(n,a,l){Ma();let f,u;if(typeof n=="object"&&"location"in n)switch(this.dataLocation=n.location,f=n.type,u=n.dims,n.location){case"cpu-pinned":{let p=tt.get(f);if(!p)throw new TypeError(`unsupported type "${f}" to create tensor from pinned buffer`);if(!(n.data instanceof p))throw new TypeError(`buffer should be of type ${p.name}`);this.cpuData=n.data;break}case"texture":{if(f!=="float32")throw new TypeError(`unsupported type "${f}" to create tensor from texture`);this.gpuTextureData=n.texture,this.downloader=n.download,this.disposer=n.dispose;break}case"gpu-buffer":{if(f!=="float32"&&f!=="float16"&&f!=="int32"&&f!=="int64"&&f!=="uint32"&&f!=="uint8"&&f!=="bool"&&f!=="uint4"&&f!=="int4")throw new TypeError(`unsupported type "${f}" to create tensor from gpu buffer`);this.gpuBufferData=n.gpuBuffer,this.downloader=n.download,this.disposer=n.dispose;break}case"ml-tensor":{if(f!=="float32"&&f!=="float16"&&f!=="int32"&&f!=="int64"&&f!=="uint32"&&f!=="uint64"&&f!=="int8"&&f!=="uint8"&&f!=="bool"&&f!=="uint4"&&f!=="int4")throw new TypeError(`unsupported type "${f}" to create tensor from MLTensor`);this.mlTensorData=n.mlTensor,this.downloader=n.download,this.disposer=n.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let p,h;if(typeof n=="string")if(f=n,h=l,n==="string"){if(!Array.isArray(a))throw new TypeError("A string tensor's data must be a string array.");p=a}else{let m=tt.get(n);if(m===void 0)throw new TypeError(`Unsupported tensor type: ${n}.`);if(Array.isArray(a)){if(n==="float16"&&m===Uint16Array||n==="uint4"||n==="int4")throw new TypeError(`Creating a ${n} tensor from number array is not supported. Please use ${m.name} as data.`);n==="uint64"||n==="int64"?p=m.from(a,BigInt):p=m.from(a)}else if(a instanceof m)p=a;else if(a instanceof Uint8ClampedArray)if(n==="uint8")p=Uint8Array.from(a);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(n==="float16"&&a instanceof Uint16Array&&m!==Uint16Array)p=new globalThis.Float16Array(a.buffer,a.byteOffset,a.length);else throw new TypeError(`A ${f} tensor's data must be type of ${m}`)}else if(h=a,Array.isArray(n)){if(n.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let m=typeof n[0];if(m==="string")f="string",p=n;else if(m==="boolean")f="bool",p=Uint8Array.from(n);else throw new TypeError(`Invalid element type of data array: ${m}.`)}else if(n instanceof Uint8ClampedArray)f="uint8",p=Uint8Array.from(n);else{let m=Ut.get(n.constructor);if(m===void 0)throw new TypeError(`Unsupported type for tensor data: ${n.constructor}.`);f=m,p=n}if(h===void 0)h=[p.length];else if(!Array.isArray(h))throw new TypeError("A tensor's dims must be a number array");u=h,this.cpuData=p,this.dataLocation="cpu"}let i=La(u);if(this.cpuData&&i!==this.cpuData.length&&!((f==="uint4"||f==="int4")&&Math.ceil(i/2)===this.cpuData.length))throw new Error(`Tensor's size(${i}) does not match data length(${this.cpuData.length}).`);this.type=f,this.dims=u,this.size=i}static async fromImage(n,a){return Ia(n,a)}static fromTexture(n,a){return Sa(n,a)}static fromGpuBuffer(n,a){return Ua(n,a)}static fromMLTensor(n,a){return Ba(n,a)}static fromPinnedBuffer(n,a,l){return Ra(n,a,l)}toDataURL(n){return Aa(this,n)}toImageData(n){return Oa(this,n)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(n){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let a=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=a,n&&this.disposer&&(this.disposer(),this.disposer=void 0),a}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(n){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return ja(this,n)}}}),Le,Pa=$(()=>{ln(),Le=Ce}),en,Lr,yt,mt,nt,it,$a=$(()=>{xa(),en=(n,a)=>{(typeof ae.trace>"u"?!ae.wasm.trace:!ae.trace)||console.timeStamp(`${n}::ORT::${a}`)},Lr=(n,a)=>{var u;let l=((u=new Error().stack)==null?void 0:u.split(/\r\n|\r|\n/g))||[],f=!1;for(let i=0;i<l.length;i++){if(f&&!l[i].includes("TRACE_FUNC")){let p=`FUNC_${n}::${l[i].trim().split(" ")[1]}`;a&&(p+=`::${a}`),en("CPU",p);return}l[i].includes("TRACE_FUNC")&&(f=!0)}},yt=n=>{(typeof ae.trace>"u"?!ae.wasm.trace:!ae.trace)||Lr("BEGIN",n)},mt=n=>{(typeof ae.trace>"u"?!ae.wasm.trace:!ae.trace)||Lr("END",n)},nt=n=>{(typeof ae.trace>"u"?!ae.wasm.trace:!ae.trace)||console.time(`ORT::${n}`)},it=n=>{(typeof ae.trace>"u"?!ae.wasm.trace:!ae.trace)||console.timeEnd(`ORT::${n}`)}}),ka,Wl=$(()=>{_a(),Pa(),$a(),ka=class Da{constructor(a){this.handler=a}async run(a,l,f){yt(),nt("InferenceSession.run");let u={},i={};if(typeof a!="object"||a===null||a instanceof Le||Array.isArray(a))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let p=!0;if(typeof l=="object"){if(l===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(l instanceof Le)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(l)){if(l.length===0)throw new TypeError("'fetches' cannot be an empty array.");p=!1;for(let y of l){if(typeof y!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(y)===-1)throw new RangeError(`'fetches' contains invalid output name: ${y}.`);u[y]=null}if(typeof f=="object"&&f!==null)i=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else{let y=!1,v=Object.getOwnPropertyNames(l);for(let C of this.outputNames)if(v.indexOf(C)!==-1){let E=l[C];(E===null||E instanceof Le)&&(y=!0,p=!1,u[C]=E)}if(y){if(typeof f=="object"&&f!==null)i=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else i=l}}else if(typeof l<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let y of this.inputNames)if(typeof a[y]>"u")throw new Error(`input '${y}' is missing in 'feeds'.`);if(p)for(let y of this.outputNames)u[y]=null;let h=await this.handler.run(a,u,i),m={};for(let y in h)if(Object.hasOwnProperty.call(h,y)){let v=h[y];v instanceof Le?m[y]=v:m[y]=new Le(v.type,v.data,v.dims)}return it("InferenceSession.run"),mt(),m}async release(){return this.handler.dispose()}static async create(a,l,f,u){yt(),nt("InferenceSession.create");let i,p={};if(typeof a=="string"){if(i=a,typeof l=="object"&&l!==null)p=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof Uint8Array){if(i=a,typeof l=="object"&&l!==null)p=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&a instanceof SharedArrayBuffer){let v=a,C=0,E=a.byteLength;if(typeof l=="object"&&l!==null)p=l;else if(typeof l=="number"){if(C=l,!Number.isSafeInteger(C))throw new RangeError("'byteOffset' must be an integer.");if(C<0||C>=v.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${v.byteLength}).`);if(E=a.byteLength-C,typeof f=="number"){if(E=f,!Number.isSafeInteger(E))throw new RangeError("'byteLength' must be an integer.");if(E<=0||C+E>v.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${v.byteLength-C}].`);if(typeof u=="object"&&u!==null)p=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof f<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof l<"u")throw new TypeError("'options' must be an object.");i=new Uint8Array(v,C,E)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[h,m]=await Ta(p),y=await h.createInferenceSessionHandler(i,m);return it("InferenceSession.create"),mt(),new Da(y)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Na,Gl=$(()=>{Wl(),Na=ka}),Fl=$(()=>{}),Vl=$(()=>{}),zl=$(()=>{}),Hl=$(()=>{}),Wa={};Rt(Wa,{InferenceSession:()=>Na,TRACE:()=>en,TRACE_EVENT_BEGIN:()=>nt,TRACE_EVENT_END:()=>it,TRACE_FUNC_BEGIN:()=>yt,TRACE_FUNC_END:()=>mt,Tensor:()=>Le,env:()=>K,registerBackend:()=>ht});var at=$(()=>{Ll(),Pl(),Gl(),Pa(),Fl(),Vl(),$a(),zl(),Hl()}),un=$(()=>{}),Ga={};Rt(Ga,{default:()=>Fa});var jr,Pr,Fa,ql=$(()=>{var n;io(),ot(),fn(),jr="ort-wasm-proxy-worker",Pr=((n=globalThis.self)==null?void 0:n.name)===jr,Pr&&(self.onmessage=a=>{let{type:l,in:f}=a.data;try{switch(l){case"init-wasm":dn(f.wasm).then(()=>{mn(f).then(()=>{postMessage({type:l})},u=>{postMessage({type:l,err:u})})},u=>{postMessage({type:l,err:u})});break;case"init-ep":{let{epName:u,env:i}=f;gn(i,u).then(()=>{postMessage({type:l})},p=>{postMessage({type:l,err:p})});break}case"copy-from":{let{buffer:u}=f,i=rr(u);postMessage({type:l,out:i});break}case"create":{let{model:u,options:i}=f;wn(u,i).then(p=>{postMessage({type:l,out:p})},p=>{postMessage({type:l,err:p})});break}case"release":bn(f),postMessage({type:l});break;case"run":{let{sessionId:u,inputIndices:i,inputs:p,outputIndices:h,options:m}=f;vn(u,i,p,h,new Array(h.length).fill(null),m).then(y=>{y.some(v=>v[3]!=="cpu")?postMessage({type:l,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:l,out:y},Tn([...p,...y]))},y=>{postMessage({type:l,err:y})});break}case"end-profiling":Cn(f),postMessage({type:l});break;default:}}catch(u){postMessage({type:l,err:u})}}),Fa=Pr?null:a=>new Worker(a??be,{type:"module",name:jr})}),Va={};Rt(Va,{default:()=>za});var $r,za,Ji,Zl=$(()=>{var n,a;$r=async function(l={}){var Zi;var f,u,i=l,p=new Promise((e,t)=>{f=e,u=t}),h=typeof window=="object",m=typeof WorkerGlobalScope<"u",y=m&&((Zi=self.name)==null?void 0:Zi.startsWith("em-pthread"));i.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(i.fc||(i.fc=new Map)).set(e,t)},i.unmountExternalData=()=>{delete i.fc};var v=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let C=()=>{let e=(t,r,o)=>(...s)=>{let d=Re,c=r==null?void 0:r();s=t(...s);let g=r==null?void 0:r();return c!==g&&(t=g,o(c),r=o=null),Re!=d?new Promise((b,T)=>{yr={resolve:b,reject:T}}):s};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])i[t]=e(i[t],()=>i[t],r=>i[t]=r)})(),typeof jsepRunAsync<"u"&&(i._OrtRun=jsepRunAsync(i._OrtRun),i._OrtRunWithBinding=jsepRunAsync(i._OrtRunWithBinding)),C=void 0};i.asyncInit=()=>{C==null||C()};var E,O,M=(e,t)=>{throw t},j=import.meta.url,N="";if(h||m){try{N=new URL(".",j).href}catch{}m&&(O=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),E=async e=>{if(Z(e))return new Promise((r,o)=>{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=()=>{s.status==200||s.status==0&&s.response?r(s.response):o(s.status)},s.onerror=o,s.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var R,S,z,q,Q,ye,Ae,W,k,se,me,H,oe,Fe,ee,Oe=console.log.bind(console),Mt=console.error.bind(console),L=Oe,J=Mt,Ie=!1,Z=e=>e.startsWith("file://");function fe(){return S.buffer!=Q.buffer&&ie(),Q}function P(){return S.buffer!=Q.buffer&&ie(),ye}function re(){return S.buffer!=Q.buffer&&ie(),Ae}function Ye(){return S.buffer!=Q.buffer&&ie(),W}function I(){return S.buffer!=Q.buffer&&ie(),k}function x(){return S.buffer!=Q.buffer&&ie(),se}function wt(){return S.buffer!=Q.buffer&&ie(),me}function le(){return S.buffer!=Q.buffer&&ie(),Fe}if(y){let e=function(t){try{var r=t.data,o=r.dc;if(o==="load"){let s=[];self.onmessage=d=>s.push(d),self.startWorker=()=>{postMessage({dc:"loaded"});for(let d of s)e(d);self.onmessage=e};for(let d of r.Uc)i[d]&&!i[d].proxy||(i[d]=(...c)=>{postMessage({dc:"callHandler",Tc:d,args:c})},d=="print"&&(L=i[d]),d=="printErr"&&(J=i[d]));S=r.bd,ie(),ee(r.cd)}else if(o==="run"){go(r.ac),Ir(r.ac,0,0,1,0,0),Sn(),cr(r.ac),Te||(_i(),Te=!0);try{wo(r.Zc,r.jc)}catch(s){if(s!="unwind")throw s}}else r.target!=="setimmediate"&&(o==="checkMailbox"?Te&&Lt():o&&(J(`worker: received unknown command ${o}`),J(r)))}catch(s){throw $i(),s}};var Te=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}function ie(){var e=S.buffer;i.HEAP8=Q=new Int8Array(e),Ae=new Int16Array(e),i.HEAPU8=ye=new Uint8Array(e),W=new Uint16Array(e),i.HEAP32=k=new Int32Array(e),i.HEAPU32=se=new Uint32Array(e),me=new Float32Array(e),Fe=new Float64Array(e),H=new BigInt64Array(e),oe=new BigUint64Array(e)}function ne(){y?startWorker(i):w.nb()}var X,de=0,je=null;function st(){if(--de==0&&je){var e=je;je=null,e()}}function Pe(e){throw J(e="Aborted("+e+")"),Ie=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),u(e),e}function _n(){return{a:{R:xl,b:vo,ba:Mn,I:Pn,ra:$n,jb:kn,lb:Dn,sa:Nn,pa:Wn,ia:Gn,oa:Fn,P:Vn,kb:zn,hb:Hn,qa:qn,ib:Zn,xa:Co,Z:To,cb:_o,ab:xo,Y:Oo,w:Io,t:So,bb:Uo,L:$o,db:ko,la:Do,fb:No,ca:Wo,_a:Go,$:Fo,ka:cr,ua:Vo,s:zo,Na:Ho,A:Xo,o:Yo,m:Qo,c:fr,Ma:Ko,n:es,i:ns,v:is,p:as,f:os,u:ss,k:ls,e:us,j:fs,h:ds,g:ps,d:cs,fa:hs,ga:ys,ha:ms,da:si,ea:li,$a:ui,za:ws,wa:vs,E:Cs,La:Ts,M:_s,va:bs,C:Es,ta:xs,gb:As,r:gs,Ia:Os,F:Is,Q:Ss,eb:Us,Ba:Bs,Aa:Rs,Ha:Ds,q:Ns,U:Ws,T:Gs,Ka:Fs,D:Vs,l:zs,Ga:Hs,Fa:qs,Ja:Zs,Ea:Xs,Da:Ys,Ca:Js,ma:yi,na:mi,aa:or,J:gi,O:wi,ja:bi,N:vi,a:S,ya:ar,Xa:Ks,K:el,x:tl,S:rl,Ya:nl,y:il,Ta:al,Va:ol,V:sl,z:ll,_:ul,W:fl,G:dl,Ra:pl,mb:cl,B:hl,Ua:yl,Wa:ml,Oa:gl,Pa:wl,Qa:bl,H:vl,X:Cl,Sa:Tl,Za:_l}}}class nr{constructor(t){Xi(this,"name","ExitStatus");this.message=`Program terminated with exit(${t})`,this.status=t}}var En=e=>{e.terminate(),e.onmessage=()=>{}},ir=[],xn=e=>{Ve.length==0&&(Bn(),Un(Ve[0]));var t=Ve.pop();if(!t)return 6;bt.push(t),Je[e.ac]=t,t.ac=e.ac;var r={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(r,e.Oc),0},te=0,Y=(e,t,...r)=>{for(var o=2*r.length,s=xe(),d=Vt(8*o),c=d>>>3,g=0;g<r.length;g++){var b=r[g];typeof b=="bigint"?(H[c+2*g]=1n,H[c+2*g+1]=b):(H[c+2*g]=0n,le()[c+2*g+1>>>0]=b)}return e=ki(e,0,o,d,t),Ee(s),e};function ar(e){if(y)return Y(0,1,e);if(q=e,!(0<te)){for(var t of bt)En(t);for(t of Ve)En(t);Ve=[],bt=[],Je={},Ie=!0}M(0,new nr(e))}function An(e){if(y)return Y(1,0,e);or(e)}var or=e=>{if(q=e,y)throw An(e),"unwind";ar(e)},Ve=[],bt=[],On=[],Je={},In=e=>{var t=e.ac;delete Je[t],Ve.push(e),bt.splice(bt.indexOf(e),1),e.ac=0,Di(t)};function Sn(){On.forEach(e=>e())}var Un=e=>new Promise(t=>{e.onmessage=s=>{var d=(s=s.data).dc;if(s.hc&&s.hc!=_r()){var c=Je[s.hc];c?c.postMessage(s,s.Oc):J(`Internal error! Worker sent a message "${d}" to target pthread ${s.hc}, but that thread no longer exists!`)}else d==="checkMailbox"?Lt():d==="spawnThread"?xn(s):d==="cleanupThread"?In(Je[s.$c]):d==="loaded"?(e.loaded=!0,t(e)):s.target==="setimmediate"?e.postMessage(s):d==="callHandler"?i[s.Tc](...s.args):d&&J(`worker sent an unknown command ${d}`)},e.onerror=s=>{throw J(`worker sent an error! ${s.filename}:${s.lineno}: ${s.message}`),s};var r,o=[];for(r of[])i.propertyIsEnumerable(r)&&o.push(r);e.postMessage({dc:"load",Uc:o,bd:S,cd:z})});function Bn(){var e=new Worker((()=>{let t=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new t("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Ve.push(e)}var go=e=>{ie();var t=x()[e+52>>>2>>>0];e=x()[e+56>>>2>>>0],Gi(t,t-e),Ee(t)},wo=(e,t)=>{te=0,e=Fi(e,t),0<te?q=e:Sr(e)};class bo{constructor(t){this.ic=t-24}}var we=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function vo(e,t,r){var o=new bo(e>>>=0);throw t>>>=0,r>>>=0,x()[o.ic+16>>>2>>>0]=0,x()[o.ic+4>>>2>>>0]=t,x()[o.ic+8>>>2>>>0]=r,e}function Rn(e,t,r,o){return y?Y(2,1,e,t,r,o):Mn(e,t,r,o)}function Mn(e,t,r,o){if(e>>>=0,r>>>=0,o>>>=0,v===void 0)return 6;var s=[];return y&&s.length===0?Rn(e,t>>>=0,r,o):(e={Yc:r,ac:e,jc:o,Oc:s},y?(e.dc="spawnThread",postMessage(e,s),0):xn(e))}var Ln=typeof TextDecoder<"u"?new TextDecoder:void 0,jn=(e,t=0,r=NaN)=>{var o=(t>>>=0)+r;for(r=t;e[r]&&!(r>=o);)++r;if(16<r-t&&e.buffer&&Ln)return Ln.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(o="";t<r;){var s=e[t++];if(128&s){var d=63&e[t++];if((224&s)==192)o+=String.fromCharCode((31&s)<<6|d);else{var c=63&e[t++];65536>(s=(240&s)==224?(15&s)<<12|d<<6|c:(7&s)<<18|d<<12|c<<6|63&e[t++])?o+=String.fromCharCode(s):(s-=65536,o+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else o+=String.fromCharCode(s)}return o},lt=(e,t)=>(e>>>=0)?jn(P(),e,t):"";function Pn(e,t,r){return y?Y(3,1,e,t,r):0}function $n(e,t){if(y)return Y(4,1,e,t)}function kn(e,t){if(y)return Y(5,1,e,t)}function Dn(e,t,r){if(y)return Y(6,1,e,t,r)}function Nn(e,t,r){return y?Y(7,1,e,t,r):0}function Wn(e,t){if(y)return Y(8,1,e,t)}function Gn(e,t,r){if(y)return Y(9,1,e,t,r)}function Fn(e,t,r,o){if(y)return Y(10,1,e,t,r,o)}function Vn(e,t,r,o){if(y)return Y(11,1,e,t,r,o)}function zn(e,t,r,o){if(y)return Y(12,1,e,t,r,o)}function Hn(e){if(y)return Y(13,1,e)}function qn(e,t){if(y)return Y(14,1,e,t)}function Zn(e,t,r){if(y)return Y(15,1,e,t,r)}var Xn,Co=()=>Pe(""),Be=e=>{for(var t="";P()[e>>>0];)t+=Xn[P()[e++>>>0]];return t},sr={},lr={},ut=i.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function $e(e,t,r={}){return function(o,s,d={}){var c=s.name;if(!o)throw new ut(`type "${c}" must have a positive integer typeid pointer`);if(lr.hasOwnProperty(o)){if(d.Vc)return;throw new ut(`Cannot register type '${c}' twice`)}lr[o]=s,sr.hasOwnProperty(o)&&(s=sr[o],delete sr[o],s.forEach(g=>g()))}(e,t,r)}var Yn=(e,t,r)=>{switch(t){case 1:return r?o=>fe()[o>>>0]:o=>P()[o>>>0];case 2:return r?o=>re()[o>>>1>>>0]:o=>Ye()[o>>>1>>>0];case 4:return r?o=>I()[o>>>2>>>0]:o=>x()[o>>>2>>>0];case 8:return r?o=>H[o>>>3]:o=>oe[o>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function To(e,t,r){r>>>=0,$e(e>>>=0,{name:t=Be(t>>>0),fromWireType:o=>o,toWireType:function(o,s){if(typeof s!="bigint"&&typeof s!="number")throw s=s===null?"null":(o=typeof s)=="object"||o==="array"||o==="function"?s.toString():""+s,new TypeError(`Cannot convert "${s}" to ${this.name}`);return typeof s=="number"&&(s=BigInt(s)),s},cc:ze,readValueFromPointer:Yn(t,r,t.indexOf("u")==-1),ec:null})}var ze=8;function _o(e,t,r,o){$e(e>>>=0,{name:t=Be(t>>>0),fromWireType:function(s){return!!s},toWireType:function(s,d){return d?r:o},cc:ze,readValueFromPointer:function(s){return this.fromWireType(P()[s>>>0])},ec:null})}var ur=[],ke=[];function fr(e){9<(e>>>=0)&&--ke[e+1]==0&&(ke[e]=void 0,ur.push(e))}var pe=e=>{if(!e)throw new ut(`Cannot use deleted val. handle = ${e}`);return ke[e]},_e=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=ur.pop()||ke.length;return ke[t]=e,ke[t+1]=1,t}};function dr(e){return this.fromWireType(x()[e>>>2>>>0])}var Eo={name:"emscripten::val",fromWireType:e=>{var t=pe(e);return fr(e),t},toWireType:(e,t)=>_e(t),cc:ze,readValueFromPointer:dr,ec:null};function xo(e){return $e(e>>>0,Eo)}var Ao=(e,t)=>{switch(t){case 4:return function(r){return this.fromWireType(wt()[r>>>2>>>0])};case 8:return function(r){return this.fromWireType(le()[r>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function Oo(e,t,r){r>>>=0,$e(e>>>=0,{name:t=Be(t>>>0),fromWireType:o=>o,toWireType:(o,s)=>s,cc:ze,readValueFromPointer:Ao(t,r),ec:null})}function Io(e,t,r,o,s){if(e>>>=0,r>>>=0,t=Be(t>>>0),s===-1&&(s=4294967295),s=g=>g,o===0){var d=32-8*r;s=g=>g<<d>>>d}var c=t.includes("unsigned")?function(g,b){return b>>>0}:function(g,b){return b};$e(e,{name:t,fromWireType:s,toWireType:c,cc:ze,readValueFromPointer:Yn(t,r,o!==0),ec:null})}function So(e,t,r){function o(d){var c=x()[d>>>2>>>0];return d=x()[d+4>>>2>>>0],new s(fe().buffer,d,c)}var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];$e(e>>>=0,{name:r=Be(r>>>0),fromWireType:o,cc:ze,readValueFromPointer:o},{Vc:!0})}var De=(e,t,r)=>{var o=P();if(t>>>=0,0<r){var s=t;r=t+r-1;for(var d=0;d<e.length;++d){var c=e.charCodeAt(d);if(55296<=c&&57343>=c&&(c=65536+((1023&c)<<10)|1023&e.charCodeAt(++d)),127>=c){if(t>=r)break;o[t++>>>0]=c}else{if(2047>=c){if(t+1>=r)break;o[t++>>>0]=192|c>>6}else{if(65535>=c){if(t+2>=r)break;o[t++>>>0]=224|c>>12}else{if(t+3>=r)break;o[t++>>>0]=240|c>>18,o[t++>>>0]=128|c>>12&63}o[t++>>>0]=128|c>>6&63}o[t++>>>0]=128|63&c}}o[t>>>0]=0,e=t-s}else e=0;return e},Ne=e=>{for(var t=0,r=0;r<e.length;++r){var o=e.charCodeAt(r);127>=o?t++:2047>=o?t+=2:55296<=o&&57343>=o?(t+=4,++r):t+=3}return t};function Uo(e,t){$e(e>>>=0,{name:t=Be(t>>>0),fromWireType:function(r){for(var o,s=x()[r>>>2>>>0],d=r+4,c=d,g=0;g<=s;++g){var b=d+g;g!=s&&P()[b>>>0]!=0||(c=lt(c,b-c),o===void 0?o=c:(o+="\0",o+=c),c=b+1)}return Se(r),o},toWireType:function(r,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var s=typeof o=="string";if(!(s||ArrayBuffer.isView(o)&&o.BYTES_PER_ELEMENT==1))throw new ut("Cannot pass non-string to std::string");var d=s?Ne(o):o.length,c=dt(4+d+1),g=c+4;return x()[c>>>2>>>0]=d,s?De(o,g,d+1):P().set(o,g>>>0),r!==null&&r.push(Se,c),c},cc:ze,readValueFromPointer:dr,ec(r){Se(r)}})}var Jn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Bo=(e,t)=>{for(var r=e>>1,o=r+t/2;!(r>=o)&&Ye()[r>>>0];)++r;if(32<(r<<=1)-e&&Jn)return Jn.decode(P().slice(e,r));for(r="",o=0;!(o>=t/2);++o){var s=re()[e+2*o>>>1>>>0];if(s==0)break;r+=String.fromCharCode(s)}return r},Ro=(e,t,r)=>{if(r??(r=2147483647),2>r)return 0;var o=t;r=(r-=2)<2*e.length?r/2:e.length;for(var s=0;s<r;++s){var d=e.charCodeAt(s);re()[t>>>1>>>0]=d,t+=2}return re()[t>>>1>>>0]=0,t-o},Mo=e=>2*e.length,Lo=(e,t)=>{for(var r=0,o="";!(r>=t/4);){var s=I()[e+4*r>>>2>>>0];if(s==0)break;++r,65536<=s?(s-=65536,o+=String.fromCharCode(55296|s>>10,56320|1023&s)):o+=String.fromCharCode(s)}return o},jo=(e,t,r)=>{if(t>>>=0,r??(r=2147483647),4>r)return 0;var o=t;r=o+r-4;for(var s=0;s<e.length;++s){var d=e.charCodeAt(s);if(55296<=d&&57343>=d&&(d=65536+((1023&d)<<10)|1023&e.charCodeAt(++s)),I()[t>>>2>>>0]=d,(t+=4)+4>r)break}return I()[t>>>2>>>0]=0,t-o},Po=e=>{for(var t=0,r=0;r<e.length;++r){var o=e.charCodeAt(r);55296<=o&&57343>=o&&++r,t+=4}return t};function $o(e,t,r){if(e>>>=0,t>>>=0,r=Be(r>>>=0),t===2)var o=Bo,s=Ro,d=Mo,c=g=>Ye()[g>>>1>>>0];else t===4&&(o=Lo,s=jo,d=Po,c=g=>x()[g>>>2>>>0]);$e(e,{name:r,fromWireType:g=>{for(var b,T=x()[g>>>2>>>0],A=g+4,_=0;_<=T;++_){var B=g+4+_*t;_!=T&&c(B)!=0||(A=o(A,B-A),b===void 0?b=A:(b+="\0",b+=A),A=B+t)}return Se(g),b},toWireType:(g,b)=>{if(typeof b!="string")throw new ut(`Cannot pass non-string to C++ string type ${r}`);var T=d(b),A=dt(4+T+t);return x()[A>>>2>>>0]=T/t,s(b,A+4,T+t),g!==null&&g.push(Se,A),A},cc:ze,readValueFromPointer:dr,ec(g){Se(g)}})}function ko(e,t){$e(e>>>=0,{Wc:!0,name:t=Be(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function Do(e){Ir(e>>>0,!m,1,!h,131072,!1),Sn()}var pr=e=>{if(!Ie)try{if(e(),!(0<te))try{y?Sr(q):or(q)}catch(t){t instanceof nr||t=="unwind"||M(0,t)}}catch(t){t instanceof nr||t=="unwind"||M(0,t)}};function cr(e){e>>>=0,typeof Atomics.ad=="function"&&(Atomics.ad(I(),e>>>2,e).value.then(Lt),e+=128,Atomics.store(I(),e>>>2,1))}var Lt=()=>{var e=_r();e&&(cr(e),pr(Wi))};function No(e,t){(e>>>=0)==t>>>0?setTimeout(Lt):y?postMessage({hc:e,dc:"checkMailbox"}):(e=Je[e])&&e.postMessage({dc:"checkMailbox"})}var hr=[];function Wo(e,t,r,o,s){for(t>>>=0,o/=2,hr.length=o,r=s>>>0>>>3,s=0;s<o;s++)hr[s]=H[r+2*s]?H[r+2*s+1]:le()[r+2*s+1>>>0];return(t?Cr[t]:El[e])(...hr)}var Go=()=>{te=0};function Fo(e){e>>>=0,y?postMessage({dc:"cleanupThread",$c:e}):In(Je[e])}function Vo(e){}var jt=(e,t)=>{var r=lr[e];if(r===void 0)throw e=Ti(e),r=Be(e),Se(e),new ut(`${t} has unknown type ${r}`);return r},Qn=(e,t,r)=>{var o=[];return e=e.toWireType(o,r),o.length&&(x()[t>>>2>>>0]=_e(o)),e};function zo(e,t,r){return t>>>=0,r>>>=0,e=pe(e>>>0),t=jt(t,"emval::as"),Qn(t,r,e)}function Ho(e,t){return t>>>=0,e=pe(e>>>0),(t=jt(t,"emval::as")).toWireType(null,e)}var Pt=e=>{try{e()}catch(t){Pe(t)}},He=0,Re=null,Kn=0,$t=[],ei={},ti={},qo=0,yr=null,Zo=[];function ri(e){return function(t){if(!Ie){if(He===0){var r=!1,o=!1;t((s=0)=>{if(!Ie&&(Kn=s,r=!0,o)){He=2,Pt(()=>Hi(Re)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),s=!1;try{var d=function(){var b=I()[Re+8>>>2>>>0];return b=w[ti[b]],--te,b()}()}catch(b){d=b,s=!0}var c=!1;if(!Re){var g=yr;g&&(yr=null,(s?g.reject:g.resolve)(d),c=!0)}if(s&&!c)throw d}}),o=!0,r||(He=1,Re=function(){var s=dt(65548),d=s+12;x()[s>>>2>>>0]=d,x()[s+4>>>2>>>0]=d+65536,d=$t[0];var c=ei[d];return c===void 0&&(c=qo++,ei[d]=c,ti[c]=d),d=c,I()[s+8>>>2>>>0]=d,s}(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),Pt(()=>Vi(Re)))}else He===2?(He=0,Pt(qi),Se(Re),Re=null,Zo.forEach(pr)):Pe(`invalid state: ${He}`);return Kn}}(t=>{e().then(t)})}function Xo(e){return e>>>=0,ri(async()=>{var t=await pe(e);return _e(t)})}var kt=[];function Yo(e,t,r,o){return r>>>=0,o>>>=0,(e=kt[e>>>0])(null,t=pe(t>>>0),r,o)}var Jo={},Dt=e=>{var t=Jo[e];return t===void 0?Be(e):t};function Qo(e,t,r,o,s){return r>>>=0,o>>>=0,s>>>=0,(e=kt[e>>>0])(t=pe(t>>>0),t[r=Dt(r)],o,s)}function Ko(e,t){return t>>>=0,(e=pe(e>>>0))==pe(t)}var ni=()=>typeof globalThis=="object"?globalThis:Function("return this")();function es(e){return(e>>>=0)==0?_e(ni()):(e=Dt(e),_e(ni()[e]))}var ts=e=>{var t=kt.length;return kt.push(e),t},rs=(e,t)=>{for(var r=Array(e),o=0;o<e;++o)r[o]=jt(x()[t+4*o>>>2>>>0],`parameter ${o}`);return r};function ns(e,t,r){var o=(t=rs(e,t>>>0)).shift();e--;var s=`return function (obj, func, destructorsRef, args) {
`,d=0,c=[];r===0&&c.push("obj");for(var g=["retType"],b=[o],T=0;T<e;++T)c.push(`arg${T}`),g.push(`argType${T}`),b.push(t[T]),s+=`  var arg${T} = argType${T}.readValueFromPointer(args${d?"+"+d:""});
`,d+=t[T].cc;return s+=`  var rv = ${r===1?"new func":"func.call"}(${c.join(", ")});
`,o.Wc||(g.push("emval_returnValue"),b.push(Qn),s+=`  return emval_returnValue(retType, destructorsRef, rv);
`),e=new Function(...g,s+`};
`)(...b),r=`methodCaller<(${t.map(A=>A.name).join(", ")}) => ${o.name}>`,ts(Object.defineProperty(e,"name",{value:r}))}function is(e){return e=Dt(e>>>0),_e(i[e])}function as(e,t){return t>>>=0,e=pe(e>>>0),t=pe(t),_e(e[t])}function os(e){9<(e>>>=0)&&(ke[e+1]+=1)}function ss(){return _e([])}function ls(e){e=pe(e>>>0);for(var t=Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return _e(t)}function us(e){return _e(Dt(e>>>0))}function fs(){return _e({})}function ds(e){for(var t=pe(e>>>=0);t.length;){var r=t.pop();t.pop()(r)}fr(e)}function ps(e,t,r){t>>>=0,r>>>=0,e=pe(e>>>0),t=pe(t),r=pe(r),e[t]=r}function cs(e,t){return t>>>=0,e=(e=jt(e>>>0,"_emval_take_value")).readValueFromPointer(t),_e(e)}function hs(e,t){e=we(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getUTCSeconds(),I()[t+4>>>2>>>0]=e.getUTCMinutes(),I()[t+8>>>2>>>0]=e.getUTCHours(),I()[t+12>>>2>>>0]=e.getUTCDate(),I()[t+16>>>2>>>0]=e.getUTCMonth(),I()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,I()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,I()[t+28>>>2>>>0]=e}var ii=e=>e%4==0&&(e%100!=0||e%400==0),ai=[0,31,60,91,121,152,182,213,244,274,305,335],oi=[0,31,59,90,120,151,181,212,243,273,304,334];function ys(e,t){e=we(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getSeconds(),I()[t+4>>>2>>>0]=e.getMinutes(),I()[t+8>>>2>>>0]=e.getHours(),I()[t+12>>>2>>>0]=e.getDate(),I()[t+16>>>2>>>0]=e.getMonth(),I()[t+20>>>2>>>0]=e.getFullYear()-1900,I()[t+24>>>2>>>0]=e.getDay();var r=(ii(e.getFullYear())?ai:oi)[e.getMonth()]+e.getDate()-1|0;I()[t+28>>>2>>>0]=r,I()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var o=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=o&&e.getTimezoneOffset()==Math.min(o,r)),I()[t+32>>>2>>>0]=e}function ms(e){e>>>=0;var t=new Date(I()[e+20>>>2>>>0]+1900,I()[e+16>>>2>>>0],I()[e+12>>>2>>>0],I()[e+8>>>2>>>0],I()[e+4>>>2>>>0],I()[e>>>2>>>0],0),r=I()[e+32>>>2>>>0],o=t.getTimezoneOffset(),s=new Date(t.getFullYear(),6,1).getTimezoneOffset(),d=new Date(t.getFullYear(),0,1).getTimezoneOffset(),c=Math.min(d,s);return 0>r?I()[e+32>>>2>>>0]=+(s!=d&&c==o):0<r!=(c==o)&&(s=Math.max(d,s),t.setTime(t.getTime()+6e4*((0<r?c:s)-o))),I()[e+24>>>2>>>0]=t.getDay(),r=(ii(t.getFullYear())?ai:oi)[t.getMonth()]+t.getDate()-1|0,I()[e+28>>>2>>>0]=r,I()[e>>>2>>>0]=t.getSeconds(),I()[e+4>>>2>>>0]=t.getMinutes(),I()[e+8>>>2>>>0]=t.getHours(),I()[e+12>>>2>>>0]=t.getDate(),I()[e+16>>>2>>>0]=t.getMonth(),I()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function si(e,t,r,o,s,d,c){return y?Y(16,1,e,t,r,o,s,d,c):-52}function li(e,t,r,o,s,d){if(y)return Y(17,1,e,t,r,o,s,d)}var vt={},gs=()=>performance.timeOrigin+performance.now();function ui(e,t){if(y)return Y(18,1,e,t);if(vt[e]&&(clearTimeout(vt[e].id),delete vt[e]),!t)return 0;var r=setTimeout(()=>{delete vt[e],pr(()=>Ni(e,performance.timeOrigin+performance.now()))},t);return vt[e]={id:r,nd:t},0}function ws(e,t,r,o){e>>>=0,t>>>=0,r>>>=0,o>>>=0;var s=new Date().getFullYear(),d=new Date(s,0,1).getTimezoneOffset();s=new Date(s,6,1).getTimezoneOffset();var c=Math.max(d,s);x()[e>>>2>>>0]=60*c,I()[t>>>2>>>0]=+(d!=s),e=(t=g=>{var b=Math.abs(g);return`UTC${0<=g?"-":"+"}${String(Math.floor(b/60)).padStart(2,"0")}${String(b%60).padStart(2,"0")}`})(d),t=t(s),s<d?(De(e,r,17),De(t,o,17)):(De(e,o,17),De(t,r,17))}var bs=()=>Date.now();function vs(e,t,r){return 0<=e&&3>=e?(e===0?e=Date.now():e=performance.timeOrigin+performance.now(),H[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0):28}var mr=[],fi=(e,t)=>{mr.length=0;for(var r;r=P()[e++>>>0];){var o=r!=105;t+=(o&=r!=112)&&t%8?4:0,mr.push(r==112?x()[t>>>2>>>0]:r==106?H[t>>>3]:r==105?I()[t>>>2>>>0]:le()[t>>>3>>>0]),t+=o?8:4}return mr};function Cs(e,t,r){return e>>>=0,t=fi(t>>>0,r>>>0),Cr[e](...t)}function Ts(e,t,r){return e>>>=0,t=fi(t>>>0,r>>>0),Cr[e](...t)}var _s=()=>{};function Es(e,t){return J(lt(e>>>0,t>>>0))}var xs=()=>{throw te+=1,"unwind"};function As(){return 4294901760}var Os=()=>1,Is=()=>navigator.hardwareConcurrency;function Ss(){return Pe("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Us(e){e>>>=0;var t=P().length;if(e<=t||4294901760<e)return!1;for(var r=1;4>=r;r*=2){var o=t*(1+.2/r);o=Math.min(o,e+100663296);e:{o=(Math.min(4294901760,65536*Math.ceil(Math.max(e,o)/65536))-S.buffer.byteLength+65535)/65536|0;try{S.grow(o),ie();var s=1;break e}catch{}s=void 0}if(s)return!0}return!1}var Nt=()=>(Pe("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Ct={},di=e=>{e.forEach(t=>{Nt()})};function Bs(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),di(e),Ct.oc=Nt(),Ct.Xc=e,Ct.oc}function Rs(e,t,r){if(e>>>=0,t>>>=0,Ct.oc==e)var o=Ct.Xc;else(o=Error().stack.toString().split(`
`))[0]=="Error"&&o.shift(),di(o);for(var s=3;o[s]&&Nt()!=e;)++s;for(e=0;e<r&&o[e+s];++e)I()[t+4*e>>>2>>>0]=Nt();return e}var We=e=>{var t=Ne(e)+1,r=Vt(t);return De(e,r,t),r},gr=[],ce=(e,t)=>{gr[e>>>=0]=t},Me=[],Wt=[],Tt=(e,t)=>{Wt[e]=new Promise(r=>t.finally(()=>r(e)))},U=e=>{if(e)return gr[e>>>0]},Gt=(e,t,r)=>{x()[e>>>2>>>0]=t,x()[e+4>>>2>>>0]=r},pi=e=>{var t=x()[e>>>2>>>0];return e=x()[e+4>>>2>>>0],lt(t,e)},Ge=e=>{var t=x()[e>>>2>>>0];return e=x()[e+4>>>2>>>0],t?lt(t,e):e===0?"":void 0},ci=(e,t)=>{function r(s,d){s=e[s],I()[t+d>>>2>>>0]=s}function o(s,d){H[t+d>>>3]=BigInt(e[s])}r("maxTextureDimension1D",4),r("maxTextureDimension2D",8),r("maxTextureDimension3D",12),r("maxTextureArrayLayers",16),r("maxBindGroups",20),r("maxBindGroupsPlusVertexBuffers",24),r("maxBindingsPerBindGroup",28),r("maxDynamicUniformBuffersPerPipelineLayout",32),r("maxDynamicStorageBuffersPerPipelineLayout",36),r("maxSampledTexturesPerShaderStage",40),r("maxSamplersPerShaderStage",44),r("maxStorageBuffersPerShaderStage",48),r("maxStorageTexturesPerShaderStage",52),r("maxUniformBuffersPerShaderStage",56),r("minUniformBufferOffsetAlignment",80),r("minStorageBufferOffsetAlignment",84),o("maxUniformBufferBindingSize",64),o("maxStorageBufferBindingSize",72),r("maxVertexBuffers",88),o("maxBufferSize",96),r("maxVertexAttributes",104),r("maxVertexBufferArrayStride",108),r("maxInterStageShaderVariables",112),r("maxColorAttachments",116),r("maxColorAttachmentBytesPerSample",120),r("maxComputeWorkgroupStorageSize",124),r("maxComputeInvocationsPerWorkgroup",128),r("maxComputeWorkgroupSizeX",132),r("maxComputeWorkgroupSizeY",136),r("maxComputeWorkgroupSizeZ",140),r("maxComputeWorkgroupsPerDimension",144),e.kd!==void 0&&r("maxImmediateSize",148)},Ms={undefined:1,pd:1,gd:2},Ls={1:"validation",2:"out-of-memory",3:"internal"},js=[,"compatibility","core"],wr={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},Ps=[,"low-power","high-performance"],$s={1:"occlusion",2:"timestamp"},ks={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function Ds(e,t,r,o,s,d){t=we(t),r=we(r),o>>>=0,s>>>=0,d>>>=0,e=U(e>>>0);var c={};if(d){var g=x()[d+12>>>2>>>0];if(g){var b=x()[d+16>>>2>>>0];c.requiredFeatures=Array.from(x().subarray(b>>>2>>>0,b+4*g>>>2>>>0),_=>wr[_])}var T=x()[d+20>>>2>>>0];if(T){let _=function(D,G,he=!1){G=T+G,(G=x()[G>>>2>>>0])==4294967295||he&&G==0||(A[D]=G)},B=function(D,G){G=T+G;var he=x()[G>>>2>>>0],Ue=x()[G+4>>>2>>>0];he==4294967295&&Ue==4294967295||(A[D]=4294967296*x()[G+4>>>2>>>0]+x()[G>>>2>>>0])};var A={};_("maxTextureDimension1D",4),_("maxTextureDimension2D",8),_("maxTextureDimension3D",12),_("maxTextureArrayLayers",16),_("maxBindGroups",20),_("maxBindGroupsPlusVertexBuffers",24),_("maxDynamicUniformBuffersPerPipelineLayout",32),_("maxDynamicStorageBuffersPerPipelineLayout",36),_("maxSampledTexturesPerShaderStage",40),_("maxSamplersPerShaderStage",44),_("maxStorageBuffersPerShaderStage",48),_("maxStorageTexturesPerShaderStage",52),_("maxUniformBuffersPerShaderStage",56),_("minUniformBufferOffsetAlignment",80),_("minStorageBufferOffsetAlignment",84),B("maxUniformBufferBindingSize",64),B("maxStorageBufferBindingSize",72),_("maxVertexBuffers",88),B("maxBufferSize",96),_("maxVertexAttributes",104),_("maxVertexBufferArrayStride",108),_("maxInterStageShaderVariables",112),_("maxColorAttachments",116),_("maxColorAttachmentBytesPerSample",120),_("maxComputeWorkgroupStorageSize",124),_("maxComputeInvocationsPerWorkgroup",128),_("maxComputeWorkgroupSizeX",132),_("maxComputeWorkgroupSizeY",136),_("maxComputeWorkgroupSizeZ",140),_("maxComputeWorkgroupsPerDimension",144),_("maxImmediateSize",148,!0),c.requiredLimits=A}(g=x()[d+24>>>2>>>0])&&(g={label:Ge(g+4)},c.defaultQueue=g),c.label=Ge(d+4)}te+=1,Tt(t,e.requestDevice(c).then(_=>{--te,ce(s,_.queue),ce(o,_),r&&(te+=1,Tt(r,_.lost.then(B=>{--te,_.onuncapturederror=()=>{};var D=xe(),G=We(B.message);Er(r,Ms[B.reason],G),Ee(D)}))),_.onuncapturederror=B=>{var D=5;B.error instanceof GPUValidationError?D=2:B.error instanceof GPUOutOfMemoryError?D=3:B.error instanceof GPUInternalError&&(D=4);var G=xe();B=We(B.error.message),Pi(o,D,B),Ee(G)},Or(t,1,o,0)},_=>{--te;var B=xe();_=We(_.message),Or(t,3,o,_),r&&Er(r,4,_),Ee(B)}))}function Ns(e){var t=U(e>>>=0),r=Me[e];if(r){for(var o=0;o<r.length;++o)r[o]();delete Me[e]}t.destroy()}var ft=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";ft.kc||(ft.kc={}),ft.kc[e]||(ft.kc[e]=1,J(e))};function Ws(e,t,r){t>>>=0,r>>>=0;var o=U(e>>>=0);r===0&&ft(),r==4294967295&&(r=void 0);try{var s=o.getMappedRange(t,r)}catch{return 0}var d=Ur(16,s.byteLength);return P().set(new Uint8Array(s),d>>>0),Me[e].push(()=>Se(d)),d}function Gs(e,t,r){t>>>=0,r>>>=0;var o=U(e>>>=0);r===0&&ft(),r==4294967295&&(r=void 0);try{var s=o.getMappedRange(t,r)}catch{return 0}var d=Ur(16,s.byteLength);return P().fill(0,d,s.byteLength),Me[e].push(()=>{new Uint8Array(s).set(P().subarray(d>>>0,d+s.byteLength>>>0)),Se(d)}),d}function Fs(e,t,r,o,s){e>>>=0,t=we(t),r=we(r),s>>>=0;var d=U(e);Me[e]=[],s==4294967295&&(s=void 0),te+=1,Tt(t,d.mapAsync(r,o>>>0,s).then(()=>{--te,xr(t,1,0)},c=>{--te,xe();var g=We(c.message);xr(t,c.name==="AbortError"?4:c.name==="OperationError"?3:0,g),delete Me[e]}))}function Vs(e){var t=U(e>>>=0),r=Me[e];if(r){for(var o=0;o<r.length;++o)r[o]();delete Me[e],t.unmap()}}function zs(e){delete gr[e>>>0]}function Hs(e,t,r){e>>>=0,t>>>=0,r>>>=0;var o=!!x()[t+32>>>2>>>0];t={label:Ge(t+4),usage:x()[t+16>>>2>>>0],size:4294967296*x()[t+28>>>2>>>0]+x()[t+24>>>2>>>0],mappedAtCreation:o},e=U(e);try{var s=e.createBuffer(t)}catch{return!1}return ce(r,s),o&&(Me[r]=[]),!0}function qs(e,t,r){e>>>=0,t>>>=0,r>>>=0;var o=x()[t>>>2>>>0],s=x()[o+4>>>2>>>0];t={label:Ge(t+4),code:""},s===2&&(t.code=pi(o+8)),ce(r,U(e).createShaderModule(t))}var Zs=e=>{U(e).destroy()};function Xs(e,t){t=we(t),e=U(e>>>0),te+=1,Tt(t,e.popErrorScope().then(r=>{--te;var o=5;r?r instanceof GPUValidationError?o=2:r instanceof GPUOutOfMemoryError?o=3:r instanceof GPUInternalError&&(o=4):o=1;var s=xe();r=r?We(r.message):0,Ar(t,1,o,r),Ee(s)},r=>{--te;var o=xe();r=We(r.message),Ar(t,1,5,r),Ee(o)}))}function Ys(e,t,r,o){if(t=we(t),o>>>=0,r>>>=0){var s=x()[r+4>>>2>>>0];s={featureLevel:js[s],powerPreference:Ps[x()[r+8>>>2>>>0]],forceFallbackAdapter:!!x()[r+12>>>2>>>0]},(r=x()[r>>>2>>>0])!==0&&(x(),s.rd=!!x()[r+8>>>2>>>0])}"gpu"in navigator?(te+=1,Tt(t,navigator.gpu.requestAdapter(s).then(d=>{if(--te,d)ce(o,d),_t(t,1,o,0);else{d=xe();var c=We("WebGPU not available on this browser (requestAdapter returned null)");_t(t,3,o,c),Ee(d)}},d=>{--te;var c=xe();d=We(d.message),_t(t,4,o,d),Ee(c)}))):(r=xe(),s=We("WebGPU not available on this browser (navigator.gpu is not available)"),_t(t,3,o,s),Ee(r))}function Js(e,t,r){return e>>>=0,t>>>=0,r>>>=0,ri(async()=>{var o=[];if(r){var s=I()[r>>>2>>>0];o.length=t+1,o[t]=new Promise(g=>setTimeout(g,s,0))}else o.length=t;for(var d=0;d<t;++d){var c=4294967296*x()[e+8*d+4>>>2>>>0]+x()[e+8*d>>>2>>>0];if(!(c in Wt))return c;o[d]=Wt[c]}return o=await Promise.race(o),delete Wt[o],o})}var br,vr={},hi=()=>{if(!br){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in vr)vr[e]===void 0?delete t[e]:t[e]=vr[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);br=r}return br};function yi(e,t){if(y)return Y(19,1,e,t);e>>>=0,t>>>=0;var r,o=0,s=0;for(r of hi()){var d=t+o;x()[e+s>>>2>>>0]=d,o+=De(r,d,1/0)+1,s+=4}return 0}function mi(e,t){if(y)return Y(20,1,e,t);e>>>=0,t>>>=0;var r=hi();for(var o of(x()[e>>>2>>>0]=r.length,e=0,r))e+=Ne(o)+1;return x()[t>>>2>>>0]=e,0}function gi(e){return y?Y(21,1,e):52}function wi(e,t,r,o){return y?Y(22,1,e,t,r,o):52}function bi(e,t,r,o){return y?Y(23,1,e,t,r,o):70}var Qs=[null,[],[]];function vi(e,t,r,o){if(y)return Y(24,1,e,t,r,o);t>>>=0,r>>>=0,o>>>=0;for(var s=0,d=0;d<r;d++){var c=x()[t>>>2>>>0],g=x()[t+4>>>2>>>0];t+=8;for(var b=0;b<g;b++){var T=e,A=P()[c+b>>>0],_=Qs[T];A===0||A===10?((T===1?L:J)(jn(_)),_.length=0):_.push(A)}s+=g}return x()[o>>>2>>>0]=s,0}function Ks(e,t){return ci(U(e>>>0).limits,t>>>0),1}function el(e,t){return U(e>>>0).features.has(wr[t])}function tl(e){return BigInt(U(e>>>0).size)}function rl(e){return BigInt(U(e>>>0).usage)}function nl(e,t){if(e>>>=0,t>>>=0){var r=Ge(t+4);r={label:r,timestampWrites:t=(t=x()[t+12>>>2>>>0])!==0?{querySet:U(x()[t+4>>>2>>>0]),beginningOfPassWriteIndex:x()[t+8>>>2>>>0],endOfPassWriteIndex:x()[t+12>>>2>>>0]}:void 0}}return e=U(e),t=Ui(0),ce(t,e.beginComputePass(r)),t}function il(e,t,r,o,s,d){r=we(r),s=we(s),d=we(d),U(e>>>0).copyBufferToBuffer(U(t>>>0),r,U(o>>>0),s,d)}function al(e){e=U(e>>>0);var t=Ii(0);return ce(t,e.finish()),t}function ol(e,t,r,o,s,d){d=we(d),U(e>>>0).resolveQuerySet(U(t>>>0),r,o,U(s>>>0),d)}function sl(e,t,r,o){U(e>>>0).dispatchWorkgroups(t,r,o)}function ll(e){U(e>>>0).end()}function ul(e,t,r,o,s){o>>>=0,s>>>=0,e=U(e>>>0),r=U(r>>>0),o==0?e.setBindGroup(t,r):e.setBindGroup(t,r,x(),s>>>2,o)}function fl(e,t){U(e>>>0).setPipeline(U(t>>>0))}function dl(e,t,r){U(e>>>0).qd(U(t>>>0),r)}function pl(e,t){e=U(e>>>0);var r=Oi(0);return ce(r,e.getBindGroupLayout(t)),r}function cl(e,t){e>>>=0;var r=Ge(4+(t>>>=0)),o=U(x()[t+12>>>2>>>0]),s=x()[t+16>>>2>>>0];t=x()[t+20>>>2>>>0];for(var d=[],c=0;c<s;++c){var g=d,b=g.push,T=t+40*c,A=x()[T+8>>>2>>>0],_=x()[T+32>>>2>>>0],B=x()[T+36>>>2>>>0],D=x()[T+4>>>2>>>0];A?(_=T+24,(_=x()[_>>>2>>>0]+4294967296*I()[_+4>>>2>>>0])==-1&&(_=void 0),T={binding:D,resource:{buffer:U(A),offset:4294967296*x()[T+4+16>>>2>>>0]+x()[T+16>>>2>>>0],size:_}}):T=_?{binding:D,resource:U(_)}:{binding:D,resource:U(B)},b.call(g,T)}return r={label:r,layout:o,entries:d},e=U(e),o=Ai(0),ce(o,e.createBindGroup(r)),o}function hl(e,t){var r;return e>>>=0,(t>>>=0)&&(r={label:Ge(t+4)}),e=U(e),t=Si(0),ce(t,e.createCommandEncoder(r)),t}function yl(e,t){e>>>=0;var r=t>>>0;t=Ge(r+4);var o=(o=x()[r+12>>>2>>>0])?U(o):"auto";if(r+=16){var s=U(x()[r+4>>>2>>>0]),d=x()[r+16>>>2>>>0],c=x()[r+20>>>2>>>0];if(d){for(var g={},b=0;b<d;++b){var T=c+24*b;g[pi(T+4)]=le()[T+16>>>3>>>0]}d=g}else d=void 0;r={module:s,constants:d,entryPoint:Ge(r+8)}}else r=void 0;return t={label:t,layout:o,compute:r},e=U(e),o=Bi(0),ce(o,e.createComputePipeline(t)),o}function ml(e,t){e>>>=0,t>>>=0,t={type:$s[x()[t+12>>>2>>>0]],count:x()[t+16>>>2>>>0]},e=U(e);var r=Ri(0);return ce(r,e.createQuerySet(t)),r}function gl(e,t){e=U(e>>>0).adapterInfo,t>>>=0,I()[t+52>>>2>>>0]=e.subgroupMinSize,I()[t+56>>>2>>>0]=e.subgroupMaxSize;var r=e.vendor+e.architecture+e.device+e.description,o=Ne(r)+1,s=dt(o);return s&&De(r,s,o),r=s,o=Ne(e.vendor),Gt(t+4,r,o),r+=o,o=Ne(e.architecture),Gt(t+12,r,o),r+=o,o=Ne(e.device),Gt(t+20,r,o),Gt(t+28,r+o,Ne(e.description)),I()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,I()[t+40>>>2>>>0]=e,I()[t+44>>>2>>>0]=0,I()[t+48>>>2>>>0]=0,1}function wl(e,t){t>>>=0,e=U(e>>>0);var r=dt(4*e.features.size),o=0,s=0;e.features.forEach(d=>{(d=ks[d])!==void 0&&(I()[r+o>>>2>>>0]=d,o+=4,s++)}),x()[t+4>>>2>>>0]=r,x()[t>>>2>>>0]=s}function bl(e,t){return ci(U(e>>>0).limits,t>>>0),1}function vl(e,t){return U(e>>>0).features.has(wr[t])}function Cl(e,t){U(e>>>0).pushErrorScope(Ls[t])}function Tl(e,t,r){t>>>=0,r>>>=0,e=U(e>>>0),t=Array.from(I().subarray(r>>>2>>>0,r+4*t>>>2>>>0),o=>U(o)),e.submit(t)}function _l(e,t,r,o,s){r=we(r),o>>>=0,s>>>=0,e=U(e>>>0),t=U(t>>>0),o=P().subarray(o>>>0,o+s>>>0),e.writeBuffer(t,r,o,0,s)}y||function(){for(var e=i.numThreads-1;e--;)Bn();ir.push(()=>{de++,function(t){y?t():Promise.all(Ve.map(Un)).then(t)}(()=>st())})}();for(var Ci=Array(256),Ft=0;256>Ft;++Ft)Ci[Ft]=String.fromCharCode(Ft);Xn=Ci,ke.push(0,1,void 0,1,null,1,!0,1,!1,1),i.count_emval_handles=()=>ke.length/2-5-ur.length,y||(S=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),ie()),i.wasmBinary&&(R=i.wasmBinary),i.stackSave=()=>xe(),i.stackRestore=e=>Ee(e),i.stackAlloc=e=>Vt(e),i.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":fe()[e>>>0]=t;break;case"i16":re()[e>>>1>>>0]=t;break;case"i32":I()[e>>>2>>>0]=t;break;case"i64":H[e>>>3]=BigInt(t);break;case"float":wt()[e>>>2>>>0]=t;break;case"double":le()[e>>>3>>>0]=t;break;case"*":x()[e>>>2>>>0]=t;break;default:Pe(`invalid type for setValue: ${r}`)}},i.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return fe()[e>>>0];case"i16":return re()[e>>>1>>>0];case"i32":return I()[e>>>2>>>0];case"i64":return H[e>>>3];case"float":return wt()[e>>>2>>>0];case"double":return le()[e>>>3>>>0];case"*":return x()[e>>>2>>>0];default:Pe(`invalid type for getValue: ${t}`)}},i.UTF8ToString=lt,i.stringToUTF8=De,i.lengthBytesUTF8=Ne;var El=[ar,An,Rn,Pn,$n,kn,Dn,Nn,Wn,Gn,Fn,Vn,zn,Hn,qn,Zn,si,li,ui,yi,mi,gi,wi,bi,vi],Cr={1048636:(e,t,r,o,s)=>{if(i===void 0||!i.fc)return 1;if((e=lt(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=i.fc.get(e)))return 2;if(t=Number(t>>>0),r=Number(r>>>0),o=Number(o>>>0),t+r>e.byteLength)return 3;try{let d=e.subarray(t,t+r);switch(s){case 0:P().set(d,o>>>0);break;case 1:i.Pc?i.Pc(o,d):i.jd(o,d);break;default:return 4}return 0}catch{return 4}},1049460:(e,t,r)=>{i.Rc(e,P().subarray(t>>>0,t+r>>>0))},1049524:()=>i.ed(),1049566:e=>{i.Qc(e)},1049603:()=>typeof wasmOffsetConverter<"u"};function xl(){return typeof wasmOffsetConverter<"u"}var w=await async function(){function e(o,s){return w=o.exports,w=function(){var d=w,c={};for(let[g,b]of Object.entries(d))c[g]=typeof b=="function"?(...T)=>{$t.push(g);try{return b(...T)}finally{Ie||($t.pop(),Re&&He===1&&$t.length===0&&(He=0,te+=1,Pt(zi),typeof Fibers<"u"&&Fibers.od()))}}:b;return c}(),w=function(){var d=w,c=b=>T=>b(T)>>>0,g=b=>()=>b()>>>0;return(d=Object.assign({},d)).ob=c(d.ob),d.Rb=g(d.Rb),d.Tb=c(d.Tb),d.Dc=(b=>(T,A)=>b(T,A)>>>0)(d.Dc),d.Gc=c(d.Gc),d.Hc=g(d.Hc),d.__cxa_get_exception_ptr=c(d.__cxa_get_exception_ptr),d}(),On.push(w.vc),z=s,st(),w}de++;var t=_n();if(i.instantiateWasm)return new Promise(o=>{i.instantiateWasm(t,(s,d)=>{o(e(s,d))})});if(y)return new Promise(o=>{ee=s=>{var d=new WebAssembly.Instance(s,_n());o(e(d,s))}});X??(X=i.locateFile?i.locateFile?i.locateFile("ort-wasm-simd-threaded.asyncify.wasm",N):N+"ort-wasm-simd-threaded.asyncify.wasm":new URL("/Parallaxer/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",import.meta.url).href);try{var r=await async function(o){var s=X;if(!R&&typeof WebAssembly.instantiateStreaming=="function"&&!Z(s))try{var d=fetch(s,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(d,o)}catch(c){J(`wasm streaming compile failed: ${c}`),J("falling back to ArrayBuffer instantiation")}return async function(c,g){try{var b=await async function(T){if(!R)try{var A=await E(T);return new Uint8Array(A)}catch{}if(T==X&&R)T=new Uint8Array(R);else{if(!O)throw"both async and sync fetching of the wasm failed";T=O(T)}return T}(c);return await WebAssembly.instantiate(b,g)}catch(T){J(`failed to asynchronously prepare wasm: ${T}`),Pe(T)}}(s,o)}(t);return e(r.instance,r.module)}catch(o){return u(o),Promise.reject(o)}}(),Ti=e=>(Ti=w.ob)(e),_i=()=>(_i=w.pb)();i._OrtInit=(e,t)=>(i._OrtInit=w.qb)(e,t),i._OrtGetLastError=(e,t)=>(i._OrtGetLastError=w.rb)(e,t),i._OrtCreateSessionOptions=(e,t,r,o,s,d,c,g,b,T)=>(i._OrtCreateSessionOptions=w.sb)(e,t,r,o,s,d,c,g,b,T),i._OrtAppendExecutionProvider=(e,t,r,o,s)=>(i._OrtAppendExecutionProvider=w.tb)(e,t,r,o,s),i._OrtAddFreeDimensionOverride=(e,t,r)=>(i._OrtAddFreeDimensionOverride=w.ub)(e,t,r),i._OrtAddSessionConfigEntry=(e,t,r)=>(i._OrtAddSessionConfigEntry=w.vb)(e,t,r),i._OrtReleaseSessionOptions=e=>(i._OrtReleaseSessionOptions=w.wb)(e),i._OrtCreateSession=(e,t,r)=>(i._OrtCreateSession=w.xb)(e,t,r),i._OrtReleaseSession=e=>(i._OrtReleaseSession=w.yb)(e),i._OrtGetInputOutputCount=(e,t,r)=>(i._OrtGetInputOutputCount=w.zb)(e,t,r),i._OrtGetInputOutputMetadata=(e,t,r,o)=>(i._OrtGetInputOutputMetadata=w.Ab)(e,t,r,o),i._OrtFree=e=>(i._OrtFree=w.Bb)(e),i._OrtCreateTensor=(e,t,r,o,s,d)=>(i._OrtCreateTensor=w.Cb)(e,t,r,o,s,d),i._OrtGetTensorData=(e,t,r,o,s)=>(i._OrtGetTensorData=w.Db)(e,t,r,o,s),i._OrtReleaseTensor=e=>(i._OrtReleaseTensor=w.Eb)(e),i._OrtCreateRunOptions=(e,t,r,o)=>(i._OrtCreateRunOptions=w.Fb)(e,t,r,o),i._OrtAddRunConfigEntry=(e,t,r)=>(i._OrtAddRunConfigEntry=w.Gb)(e,t,r),i._OrtReleaseRunOptions=e=>(i._OrtReleaseRunOptions=w.Hb)(e),i._OrtCreateBinding=e=>(i._OrtCreateBinding=w.Ib)(e),i._OrtBindInput=(e,t,r)=>(i._OrtBindInput=w.Jb)(e,t,r),i._OrtBindOutput=(e,t,r,o)=>(i._OrtBindOutput=w.Kb)(e,t,r,o),i._OrtClearBoundOutputs=e=>(i._OrtClearBoundOutputs=w.Lb)(e),i._OrtReleaseBinding=e=>(i._OrtReleaseBinding=w.Mb)(e),i._OrtRunWithBinding=(e,t,r,o,s)=>(i._OrtRunWithBinding=w.Nb)(e,t,r,o,s),i._OrtRun=(e,t,r,o,s,d,c,g)=>(i._OrtRun=w.Ob)(e,t,r,o,s,d,c,g),i._OrtEndProfiling=e=>(i._OrtEndProfiling=w.Pb)(e);var Tr=i._OrtGetWebGpuDevice=e=>(Tr=i._OrtGetWebGpuDevice=w.Qb)(e),_r=()=>(_r=w.Rb)(),Se=i._free=e=>(Se=i._free=w.Sb)(e),dt=i._malloc=e=>(dt=i._malloc=w.Tb)(e),Ei=i._wgpuBufferRelease=e=>(Ei=i._wgpuBufferRelease=w.Ub)(e),xi=i._wgpuCreateInstance=e=>(xi=i._wgpuCreateInstance=w.Vb)(e),Ai=e=>(Ai=w.Wb)(e),Oi=e=>(Oi=w.Xb)(e),Ii=e=>(Ii=w.Yb)(e),Si=e=>(Si=w.Zb)(e),Ui=e=>(Ui=w._b)(e),Bi=e=>(Bi=w.$b)(e),Ri=e=>(Ri=w.bc)(e),Mi=(e,t)=>(Mi=w.lc)(e,t),Li=(e,t)=>(Li=w.mc)(e,t),ji=e=>(ji=w.nc)(e),Er=(e,t,r)=>(Er=w.pc)(e,t,r),xr=(e,t,r)=>(xr=w.qc)(e,t,r),Ar=(e,t,r,o)=>(Ar=w.rc)(e,t,r,o),_t=(e,t,r,o)=>(_t=w.sc)(e,t,r,o),Or=(e,t,r,o)=>(Or=w.tc)(e,t,r,o),Pi=(e,t,r)=>(Pi=w.uc)(e,t,r),Ir=(e,t,r,o,s,d)=>(Ir=w.wc)(e,t,r,o,s,d),$i=()=>($i=w.xc)(),ki=(e,t,r,o,s)=>(ki=w.yc)(e,t,r,o,s),Di=e=>(Di=w.zc)(e),Sr=e=>(Sr=w.Ac)(e),Ni=(e,t)=>(Ni=w.Bc)(e,t),Wi=()=>(Wi=w.Cc)(),Ur=(e,t)=>(Ur=w.Dc)(e,t),Gi=(e,t)=>(Gi=w.Ec)(e,t),Ee=e=>(Ee=w.Fc)(e),Vt=e=>(Vt=w.Gc)(e),xe=()=>(xe=w.Hc)(),Fi=i.dynCall_ii=(e,t)=>(Fi=i.dynCall_ii=w.Ic)(e,t);i.dynCall_viiii=(e,t,r,o,s)=>(i.dynCall_viiii=w.dynCall_viiii)(e,t,r,o,s),i.dynCall_viiiii=(e,t,r,o,s,d)=>(i.dynCall_viiiii=w.dynCall_viiiii)(e,t,r,o,s,d),i.dynCall_viii=(e,t,r,o)=>(i.dynCall_viii=w.Jc)(e,t,r,o),i.dynCall_vi=(e,t)=>(i.dynCall_vi=w.dynCall_vi)(e,t),i.dynCall_viijj=(e,t,r,o,s)=>(i.dynCall_viijj=w.dynCall_viijj)(e,t,r,o,s),i.dynCall_viiiiii=(e,t,r,o,s,d,c)=>(i.dynCall_viiiiii=w.dynCall_viiiiii)(e,t,r,o,s,d,c),i.dynCall_viiiiiiii=(e,t,r,o,s,d,c,g,b)=>(i.dynCall_viiiiiiii=w.dynCall_viiiiiiii)(e,t,r,o,s,d,c,g,b),i.dynCall_i=e=>(i.dynCall_i=w.dynCall_i)(e),i.dynCall_vii=(e,t,r)=>(i.dynCall_vii=w.dynCall_vii)(e,t,r),i.dynCall_fffffff=(e,t,r,o,s,d,c)=>(i.dynCall_fffffff=w.dynCall_fffffff)(e,t,r,o,s,d,c),i.dynCall_iiiii=(e,t,r,o,s)=>(i.dynCall_iiiii=w.dynCall_iiiii)(e,t,r,o,s),i.dynCall_iii=(e,t,r)=>(i.dynCall_iii=w.dynCall_iii)(e,t,r),i.dynCall_iiiiii=(e,t,r,o,s,d)=>(i.dynCall_iiiiii=w.dynCall_iiiiii)(e,t,r,o,s,d),i.dynCall_iiiiiiii=(e,t,r,o,s,d,c,g)=>(i.dynCall_iiiiiiii=w.dynCall_iiiiiiii)(e,t,r,o,s,d,c,g),i.dynCall_iiiiiii=(e,t,r,o,s,d,c)=>(i.dynCall_iiiiiii=w.dynCall_iiiiiii)(e,t,r,o,s,d,c),i.dynCall_iiii=(e,t,r,o)=>(i.dynCall_iiii=w.dynCall_iiii)(e,t,r,o),i.dynCall_vfiii=(e,t,r,o,s)=>(i.dynCall_vfiii=w.dynCall_vfiii)(e,t,r,o,s),i.dynCall_viiiiff=(e,t,r,o,s,d,c)=>(i.dynCall_viiiiff=w.dynCall_viiiiff)(e,t,r,o,s,d,c),i.dynCall_viiiiiff=(e,t,r,o,s,d,c,g)=>(i.dynCall_viiiiiff=w.dynCall_viiiiiff)(e,t,r,o,s,d,c,g),i.dynCall_ffff=(e,t,r,o)=>(i.dynCall_ffff=w.dynCall_ffff)(e,t,r,o),i.dynCall_viiff=(e,t,r,o,s)=>(i.dynCall_viiff=w.dynCall_viiff)(e,t,r,o,s),i.dynCall_jjjjjjj=(e,t,r,o,s,d,c)=>(i.dynCall_jjjjjjj=w.dynCall_jjjjjjj)(e,t,r,o,s,d,c),i.dynCall_jjjjjj=(e,t,r,o,s,d)=>(i.dynCall_jjjjjj=w.dynCall_jjjjjj)(e,t,r,o,s,d),i.dynCall_iijjii=(e,t,r,o,s,d)=>(i.dynCall_iijjii=w.dynCall_iijjii)(e,t,r,o,s,d),i.dynCall_viiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D)=>(i.dynCall_viiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D),i.dynCall_viiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A)=>(i.dynCall_viiiiiiiiii=w.dynCall_viiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A),i.dynCall_viiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_)=>(i.dynCall_viiiiiiiiiii=w.dynCall_viiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_),i.dynCall_viiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B)=>(i.dynCall_viiiiiiiiiiii=w.dynCall_viiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B),i.dynCall_viiiiiiiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe,Et)=>(i.dynCall_viiiiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe,Et),i.dynCall_viiiiiiiii=(e,t,r,o,s,d,c,g,b,T)=>(i.dynCall_viiiiiiiii=w.dynCall_viiiiiiiii)(e,t,r,o,s,d,c,g,b,T),i.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe,Et,Br)=>(i.dynCall_viiiiiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe,Et,Br),i.dynCall_viiiiiii=(e,t,r,o,s,d,c,g)=>(i.dynCall_viiiiiii=w.dynCall_viiiiiii)(e,t,r,o,s,d,c,g),i.dynCall_viiiiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he)=>(i.dynCall_viiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he),i.dynCall_jiji=(e,t,r,o)=>(i.dynCall_jiji=w.dynCall_jiji)(e,t,r,o),i.dynCall_v=e=>(i.dynCall_v=w.dynCall_v)(e),i.dynCall_iidiiii=(e,t,r,o,s,d,c)=>(i.dynCall_iidiiii=w.dynCall_iidiiii)(e,t,r,o,s,d,c),i.dynCall_ji=(e,t)=>(i.dynCall_ji=w.dynCall_ji)(e,t),i.dynCall_vij=(e,t,r)=>(i.dynCall_vij=w.dynCall_vij)(e,t,r),i.dynCall_viiijii=(e,t,r,o,s,d,c)=>(i.dynCall_viiijii=w.dynCall_viiijii)(e,t,r,o,s,d,c),i.dynCall_viijiiiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe)=>(i.dynCall_viijiiiiiiiiiiiiii=w.dynCall_viijiiiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe),i.dynCall_viiiji=(e,t,r,o,s,d)=>(i.dynCall_viiiji=w.dynCall_viiiji)(e,t,r,o,s,d),i.dynCall_jfi=(e,t,r)=>(i.dynCall_jfi=w.dynCall_jfi)(e,t,r),i.dynCall_fif=(e,t,r)=>(i.dynCall_fif=w.dynCall_fif)(e,t,r),i.dynCall_jii=(e,t,r)=>(i.dynCall_jii=w.dynCall_jii)(e,t,r),i.dynCall_viiiijii=(e,t,r,o,s,d,c,g)=>(i.dynCall_viiiijii=w.dynCall_viiiijii)(e,t,r,o,s,d,c,g),i.dynCall_iij=(e,t,r)=>(i.dynCall_iij=w.dynCall_iij)(e,t,r),i.dynCall_viji=(e,t,r,o)=>(i.dynCall_viji=w.dynCall_viji)(e,t,r,o),i.dynCall_iiiiiiiii=(e,t,r,o,s,d,c,g,b)=>(i.dynCall_iiiiiiiii=w.dynCall_iiiiiiiii)(e,t,r,o,s,d,c,g,b),i.dynCall_iiij=(e,t,r,o)=>(i.dynCall_iiij=w.dynCall_iiij)(e,t,r,o),i.dynCall_iiiiiiiiii=(e,t,r,o,s,d,c,g,b,T)=>(i.dynCall_iiiiiiiiii=w.dynCall_iiiiiiiiii)(e,t,r,o,s,d,c,g,b,T),i.dynCall_iiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B)=>(i.dynCall_iiiiiiiiiiiii=w.dynCall_iiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B),i.dynCall_iiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A)=>(i.dynCall_iiiiiiiiiii=w.dynCall_iiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A),i.dynCall_iijii=(e,t,r,o,s)=>(i.dynCall_iijii=w.dynCall_iijii)(e,t,r,o,s),i.dynCall_fiii=(e,t,r,o)=>(i.dynCall_fiii=w.dynCall_fiii)(e,t,r,o),i.dynCall_viijii=(e,t,r,o,s,d)=>(i.dynCall_viijii=w.dynCall_viijii)(e,t,r,o,s,d),i.dynCall_viij=(e,t,r,o)=>(i.dynCall_viij=w.dynCall_viij)(e,t,r,o),i.dynCall_jiij=(e,t,r,o)=>(i.dynCall_jiij=w.dynCall_jiij)(e,t,r,o),i.dynCall_fi=(e,t)=>(i.dynCall_fi=w.dynCall_fi)(e,t),i.dynCall_fii=(e,t,r)=>(i.dynCall_fii=w.dynCall_fii)(e,t,r),i.dynCall_dii=(e,t,r)=>(i.dynCall_dii=w.dynCall_dii)(e,t,r),i.dynCall_fiiii=(e,t,r,o,s)=>(i.dynCall_fiiii=w.dynCall_fiiii)(e,t,r,o,s),i.dynCall_viiiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G)=>(i.dynCall_viiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G),i.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe,Et,Br,Al)=>(i.dynCall_viiiiiiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue,Qe,Et,Br,Al),i.dynCall_viiiiiiiiiiiiiiii=(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue)=>(i.dynCall_viiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiii)(e,t,r,o,s,d,c,g,b,T,A,_,B,D,G,he,Ue),i.dynCall_iif=(e,t,r)=>(i.dynCall_iif=w.dynCall_iif)(e,t,r),i.dynCall_jiiii=(e,t,r,o,s)=>(i.dynCall_jiiii=w.dynCall_jiiii)(e,t,r,o,s),i.dynCall_jiii=(e,t,r,o)=>(i.dynCall_jiii=w.dynCall_jiii)(e,t,r,o),i.dynCall_viif=(e,t,r,o)=>(i.dynCall_viif=w.dynCall_viif)(e,t,r,o),i.dynCall_viiij=(e,t,r,o,s)=>(i.dynCall_viiij=w.dynCall_viiij)(e,t,r,o,s),i.dynCall_iiiiij=(e,t,r,o,s,d)=>(i.dynCall_iiiiij=w.dynCall_iiiiij)(e,t,r,o,s,d),i.dynCall_iiiiid=(e,t,r,o,s,d)=>(i.dynCall_iiiiid=w.dynCall_iiiiid)(e,t,r,o,s,d),i.dynCall_iiiiijj=(e,t,r,o,s,d,c)=>(i.dynCall_iiiiijj=w.dynCall_iiiiijj)(e,t,r,o,s,d,c),i.dynCall_iiiiiijj=(e,t,r,o,s,d,c,g)=>(i.dynCall_iiiiiijj=w.dynCall_iiiiiijj)(e,t,r,o,s,d,c,g);var Vi=e=>(Vi=w.Kc)(e),zi=()=>(zi=w.Lc)(),Hi=e=>(Hi=w.Mc)(e),qi=()=>(qi=w.Nc)();return function e(){if(0<de)je=e;else if(y)f(i),ne();else{for(;0<ir.length;)ir.shift()(i);0<de?je=e:(i.calledRun=!0,Ie||(ne(),f(i)))}}(),i.PTR_SIZE=4,i.webgpuInit=e=>{let t=new WeakMap,r,o,s=1;i.webgpuRegisterDevice=g=>{if(o!==void 0)throw Error("another WebGPU EP inference session is being created.");if(g){var b=t.get(g);if(!b){let T=((A,_=0)=>{var B=ji(_);return _=Li(_,B),ce(B,A.queue),ce(_,A),_})(g,b=xi(0));b=[s++,b,T],t.set(g,b)}return r=g,o=b[0],b}r=void 0,o=0};let d=new Map;i.webgpuOnCreateSession=g=>{if(o!==void 0){var b=o;if(o=void 0,g){let T=Tr(b);d.set(g,T),b===0&&e(r??U(T))}r=void 0}},i.webgpuOnReleaseSession=g=>{d.delete(g)};let c=Symbol("gpuBufferMetadata");i.webgpuRegisterBuffer=(g,b,T)=>{if(T)return g[c]=[T,NaN],T;if(T=g[c])return T[1]++,T[0];if((b=d.get(b))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return b=((A,_=0)=>(A.mapState!="pending"||Pe(),_=Mi(_,A.mapState=="mapped"?3:1),ce(_,A),A.mapState=="mapped"&&(Me[_]=[]),_))(g,b),g[c]=[b,1],b},i.webgpuUnregisterBuffer=g=>{let b=g[c];if(!b)throw Error("Buffer is not registered");b[1]--,b[1]===0&&(Ei(b[0]),delete g[c])},i.webgpuGetBuffer=g=>U(g),i.webgpuCreateDownloader=(g,b,T)=>{if((T=d.get(T))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let A=U(T),_=16*Math.ceil(Number(b)/16);return async()=>{let B=A.createBuffer({size:_,usage:9});try{let D=A.createCommandEncoder();return D.copyBufferToBuffer(g,0,B,0,_),A.queue.submit([D.finish()]),await B.mapAsync(GPUMapMode.READ),B.getMappedRange().slice(0,b)}finally{B.destroy()}}},i.Pc=(g,b)=>{var T=b.buffer;let A=b.byteOffset,_=b.byteLength;if(b=16*Math.ceil(Number(_)/16),g=U(g),!r){var B=Tr(o);r=U(B)}let D=(B=r.createBuffer({mappedAtCreation:!0,size:b,usage:6})).getMappedRange();new Uint8Array(D).set(new Uint8Array(T,A,_)),B.unmap(),(T=r.createCommandEncoder()).copyBufferToBuffer(B,0,g,0,b),r.queue.submit([T.finish()]),B.destroy()}},i.webnnInit=e=>{let t=e[0];[i.ed,i.Qc,i.webnnEnsureTensor,i.Rc,i.webnnDownloadTensor,i.dd,i.webnnEnableTraceEvent]=e.slice(1),i.webnnReleaseTensorId=i.Qc,i.webnnUploadTensor=i.Rc,i.webnnRegisterMLContext=i.dd,i.webnnOnRunStart=r=>t.onRunStart(r),i.webnnOnRunEnd=t.onRunEnd.bind(t),i.webnnOnReleaseSession=r=>{t.onReleaseSession(r)},i.webnnCreateMLTensorDownloader=(r,o)=>t.createMLTensorDownloader(r,o),i.webnnRegisterMLTensor=(r,o,s,d)=>t.registerMLTensor(r,o,s,d),i.webnnCreateMLContext=r=>t.createMLContext(r),i.webnnRegisterMLConstant=(r,o,s,d,c,g)=>t.registerMLConstant(r,o,s,d,c,i.fc,g),i.webnnRegisterGraphInput=t.registerGraphInput.bind(t),i.webnnIsGraphInput=t.isGraphInput.bind(t),i.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),i.webnnIsGraphOutput=t.isGraphOutput.bind(t),i.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),i.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},p},za=$r,Ji=(a=(n=globalThis.self)==null?void 0:n.name)==null?void 0:a.startsWith("em-pthread"),Ji&&$r()}),kr,tn,Qi,be,Ha,Ht,Ki,ea,Dr,ta,Nr,qa,Wr,Za,fn=$(()=>{un(),kr=typeof location>"u"?void 0:location.origin,tn=import.meta.url>"file:"&&import.meta.url<"file;",Qi=()=>{{if(tn){let n=URL;return new URL(new n("ort.webgpu.bundle.min.mjs",import.meta.url).href,kr).href}return import.meta.url}},be=Qi(),Ha=()=>{if(be&&!be.startsWith("blob:"))return be.substring(0,be.lastIndexOf("/")+1)},Ht=(n,a)=>{try{let l=a??be;return(l?new URL(n,l):new URL(n)).origin===kr}catch{return!1}},Ki=(n,a)=>{let l=a??be;try{return(l?new URL(n,l):new URL(n)).href}catch{return}},ea=(n,a)=>`${a??"./"}${n}`,Dr=async n=>{let a=await(await fetch(n,{credentials:"same-origin"})).blob();return URL.createObjectURL(a)},ta=async n=>(await import(n)).default,Nr=(ql(),Kt(Ga)).default,qa=async()=>{if(!be)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Ht(be))return[void 0,Nr()];let n=await Dr(be);return[n,Nr(n)]},Wr=(Zl(),Kt(Va)).default,Za=async(n,a,l,f)=>{let u=Wr&&!(n||a);if(u)if(be)u=Ht(be);else if(f&&!l)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,Wr];{let i="ort-wasm-simd-threaded.asyncify.mjs",p=n??Ki(i,a),h=l&&p&&!Ht(p,a),m=h?await Dr(p):p??ea(i,a);return[h?m:void 0,await ta(m)]}}}),Gr,qt,At,Fr,ra,na,ia,dn,V,ot=$(()=>{fn(),qt=!1,At=!1,Fr=!1,ra=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},na=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ia=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},dn=async n=>{if(qt)return Promise.resolve();if(At)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Fr)throw new Error("previous call to 'initializeWebAssembly()' failed.");At=!0;let a=n.initTimeout,l=n.numThreads;if(n.simd!==!1){if(n.simd==="relaxed"){if(!ia())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!na())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let f=ra();l>1&&!f&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+l+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),n.numThreads=l=1);let u=n.wasmPaths,i=typeof u=="string"?u:void 0,p=u==null?void 0:u.mjs,h=(p==null?void 0:p.href)??p,m=u==null?void 0:u.wasm,y=(m==null?void 0:m.href)??m,v=n.wasmBinary,[C,E]=await Za(h,i,l>1,!!v||!!y),O=!1,M=[];if(a>0&&M.push(new Promise(j=>{setTimeout(()=>{O=!0,j()},a)})),M.push(new Promise((j,N)=>{let R={numThreads:l};if(v)R.wasmBinary=v;else if(y||i)R.locateFile=S=>y??i+S;else if(h&&h.indexOf("blob:")!==0)R.locateFile=S=>new URL(S,h).href;else if(C){let S=Ha();S&&(R.locateFile=z=>S+z)}E(R).then(S=>{At=!1,qt=!0,Gr=S,j(),C&&URL.revokeObjectURL(C)},S=>{At=!1,Fr=!0,N(S)})})),await Promise.race(M),O)throw new Error(`WebAssembly backend initializing failed due to timeout: ${a}ms`)},V=()=>{if(qt&&Gr)return Gr;throw new Error("WebAssembly is not initialized yet.")}}),ve,er,F,pn=$(()=>{ot(),ve=(n,a)=>{let l=V(),f=l.lengthBytesUTF8(n)+1,u=l._malloc(f);return l.stringToUTF8(n,u,f),a.push(u),u},er=(n,a,l,f)=>{if(typeof n=="object"&&n!==null){if(l.has(n))throw new Error("Circular reference in options");l.add(n)}Object.entries(n).forEach(([u,i])=>{let p=a?a+u:u;if(typeof i=="object")er(i,p+".",l,f);else if(typeof i=="string"||typeof i=="number")f(p,i.toString());else if(typeof i=="boolean")f(p,i?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof i}`)})},F=n=>{let a=V(),l=a.stackSave();try{let f=a.PTR_SIZE,u=a.stackAlloc(2*f);a._OrtGetLastError(u,u+f);let i=Number(a.getValue(u,f===4?"i32":"i64")),p=a.getValue(u+f,"*"),h=p?a.UTF8ToString(p):"";throw new Error(`${n} ERROR_CODE: ${i}, ERROR_MESSAGE: ${h}`)}finally{a.stackRestore(l)}}}),Xa,Xl=$(()=>{ot(),pn(),Xa=n=>{let a=V(),l=0,f=[],u=n||{};try{if((n==null?void 0:n.logSeverityLevel)===void 0)u.logSeverityLevel=2;else if(typeof n.logSeverityLevel!="number"||!Number.isInteger(n.logSeverityLevel)||n.logSeverityLevel<0||n.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${n.logSeverityLevel}`);if((n==null?void 0:n.logVerbosityLevel)===void 0)u.logVerbosityLevel=0;else if(typeof n.logVerbosityLevel!="number"||!Number.isInteger(n.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${n.logVerbosityLevel}`);(n==null?void 0:n.terminate)===void 0&&(u.terminate=!1);let i=0;return(n==null?void 0:n.tag)!==void 0&&(i=ve(n.tag,f)),l=a._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,i),l===0&&F("Can't create run options."),(n==null?void 0:n.extra)!==void 0&&er(n.extra,"",new WeakSet,(p,h)=>{let m=ve(p,f),y=ve(h,f);a._OrtAddRunConfigEntry(l,m,y)!==0&&F(`Can't set a run config entry: ${p} - ${h}.`)}),[l,f]}catch(i){throw l!==0&&a._OrtReleaseRunOptions(l),f.forEach(p=>a._free(p)),i}}}),aa,oa,sa,Zt,Xt,la,Ya,Yl=$(()=>{ot(),pn(),aa=n=>{switch(n){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${n}`)}},oa=n=>{switch(n){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${n}`)}},sa=n=>{n.extra||(n.extra={}),n.extra.session||(n.extra.session={});let a=n.extra.session;a.use_ort_model_bytes_directly||(a.use_ort_model_bytes_directly="1"),n.executionProviders&&n.executionProviders.some(l=>(typeof l=="string"?l:l.name)==="webgpu")&&(n.enableMemPattern=!1)},Zt=(n,a,l,f)=>{let u=ve(a,f),i=ve(l,f);V()._OrtAddSessionConfigEntry(n,u,i)!==0&&F(`Can't set a session config entry: ${a} - ${l}.`)},Xt=(n,a,l,f)=>{let u=ve(a,f),i=ve(l,f);n.push([u,i])},la=async(n,a,l)=>{for(let f of a){let u=typeof f=="string"?f:f.name,i=[];switch(u){case"webnn":if(u="WEBNN",typeof f!="string"){let v=f==null?void 0:f.deviceType;v&&Zt(n,"deviceType",v,l)}break;case"webgpu":{u="WebGPU";let v;if(typeof f!="string"){let E=f;if(E.device)if(typeof GPUDevice<"u"&&E.device instanceof GPUDevice)v=E.device;else throw new Error("Invalid GPU device set in WebGPU EP options.")}let C=V().webgpuRegisterDevice(v);if(C){let[E,O,M]=C;Xt(i,"deviceId",E.toString(),l),Xt(i,"webgpuInstance",O.toString(),l),Xt(i,"webgpuDevice",M.toString(),l)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${u}`)}let p=ve(u,l),h=i.length,m=0,y=0;if(h>0){m=V()._malloc(h*V().PTR_SIZE),l.push(m),y=V()._malloc(h*V().PTR_SIZE),l.push(y);for(let v=0;v<h;v++)V().setValue(m+v*V().PTR_SIZE,i[v][0],"*"),V().setValue(y+v*V().PTR_SIZE,i[v][1],"*")}await V()._OrtAppendExecutionProvider(n,p,m,y,h)!==0&&F(`Can't append execution provider: ${u}.`)}},Ya=async n=>{let a=V(),l=0,f=[],u=n||{};sa(u);try{let i=aa(u.graphOptimizationLevel??"all"),p=oa(u.executionMode??"sequential"),h=typeof u.logId=="string"?ve(u.logId,f):0,m=u.logSeverityLevel??2;if(!Number.isInteger(m)||m<0||m>4)throw new Error(`log severity level is not valid: ${m}`);let y=u.logVerbosityLevel??0;if(!Number.isInteger(y)||y<0||y>4)throw new Error(`log verbosity level is not valid: ${y}`);let v=typeof u.optimizedModelFilePath=="string"?ve(u.optimizedModelFilePath,f):0;if(l=a._OrtCreateSessionOptions(i,!!u.enableCpuMemArena,!!u.enableMemPattern,p,!!u.enableProfiling,0,h,m,y,v),l===0&&F("Can't create session options."),u.executionProviders&&await la(l,u.executionProviders,f),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);Zt(l,"enableGraphCapture",u.enableGraphCapture.toString(),f)}if(u.freeDimensionOverrides)for(let[C,E]of Object.entries(u.freeDimensionOverrides)){if(typeof C!="string")throw new Error(`free dimension override name must be a string: ${C}`);if(typeof E!="number"||!Number.isInteger(E)||E<0)throw new Error(`free dimension override value must be a non-negative integer: ${E}`);let O=ve(C,f);a._OrtAddFreeDimensionOverride(l,O,E)!==0&&F(`Can't set a free dimension override: ${C} - ${E}.`)}return u.extra!==void 0&&er(u.extra,"",new WeakSet,(C,E)=>{Zt(l,C,E,f)}),[l,f]}catch(i){throw l!==0&&a._OrtReleaseSessionOptions(l)!==0&&F("Can't release session options."),f.forEach(p=>a._free(p)),i}}}),rt,Qt,ct,Bt,tr,cn,hn,rn,gt=$(()=>{rt=n=>{switch(n){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${n}`)}},Qt=n=>{switch(n){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${n}`)}},ct=(n,a)=>{let l=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][n],f=typeof a=="number"?a:a.reduce((u,i)=>u*i,1);return l>0?Math.ceil(f*l):void 0},Bt=n=>{switch(n){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${n}`)}},tr=n=>{switch(n){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${n}`)}},cn=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",hn=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint64"||n==="int8"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",rn=n=>{switch(n){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${n}`)}}}),yn,Ja=$(()=>{un(),yn=async n=>{if(typeof n=="string"){let a=await fetch(n);if(!a.ok)throw new Error(`failed to load external data file: ${n}`);let l=a.headers.get("Content-Length"),f=l?parseInt(l,10):0;if(f<1073741824)return new Uint8Array(await a.arrayBuffer());{if(!a.body)throw new Error(`failed to load external data file: ${n}, no response body.`);let u=a.body.getReader(),i;try{i=new ArrayBuffer(f)}catch(h){if(h instanceof RangeError){let m=Math.ceil(f/65536);i=new WebAssembly.Memory({initial:m,maximum:m}).buffer}else throw h}let p=0;for(;;){let{done:h,value:m}=await u.read();if(h)break;let y=m.byteLength;new Uint8Array(i,p,y).set(m),p+=y}return new Uint8Array(i,0,f)}}else return n instanceof Blob?new Uint8Array(await n.arrayBuffer()):n instanceof Uint8Array?n:new Uint8Array(n)}}),Qa,Jl=$(()=>{gt(),Qa=(n,a)=>new(Bt(a))(n)}),ua,fa,da,pa,Ka,ca,ue,eo=$(()=>{gt(),ua=["V","I","W","E","F"],fa=(n,a)=>{console.log(`[${ua[n]},${new Date().toISOString()}]${a}`)},Ka=(n,a)=>{da=n,pa=a},ca=(n,a)=>{let l=tr(n),f=tr(da);l>=f&&fa(l,typeof a=="function"?a():a)},ue=(...n)=>{pa&&ca(...n)}}),Vr,nn,zr,ha,Hr,ya,qr,Zr,Xr,ma,to,Ql=$(()=>{gt(),eo(),Vr=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),nn=(n,a)=>{if(a==="int32")return n;let l=Vr.get(a);if(!l)throw new Error(`WebNN backend does not support data type: ${a}`);let f=l/8;if(n.byteLength%f!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${f}.`);let u=n.byteLength/f,i=new(Bt(a))(n.buffer,n.byteOffset,u);switch(a){case"int64":case"uint64":{let p=new Int32Array(u);for(let h=0;h<u;h++){let m=i[h];if(m>2147483647n||m<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");p[h]=Number(m)}return new Uint8Array(p.buffer)}case"int8":case"uint8":case"uint32":{if(a==="uint32"&&i.some(h=>h>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let p=Int32Array.from(i,Number);return new Uint8Array(p.buffer)}default:throw new Error(`Unsupported data conversion from ${a} to 'int32'`)}},zr=(n,a)=>{if(a==="int32")return n;if(n.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let l=n.byteLength/4,f=new Int32Array(n.buffer,n.byteOffset,l);switch(a){case"int64":{let u=BigInt64Array.from(f,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(f.some(i=>i<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(f,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(f.some(i=>i<-128||i>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(f,Number);return new Uint8Array(u.buffer)}case"uint8":{if(f.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(f,Number)}case"uint32":{if(f.some(i=>i<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(f,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${a}`)}},ha=1,Hr=()=>ha++,ya=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),qr=(n,a)=>{let l=Vr.get(n);if(!l)throw new Error(`WebNN backend does not support data type: ${n}`);return a.length>0?Math.ceil(a.reduce((f,u)=>f*u)*l/8):0},Zr=class{constructor(n){this.isDataConverted=!1;let{sessionId:a,context:l,tensor:f,dataType:u,shape:i,fallbackDataType:p}=n;this.sessionId=a,this.mlContext=l,this.mlTensor=f,this.dataType=u,this.tensorShape=i,this.fallbackDataType=p}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return qr(this.dataType,this.tensorShape)}destroy(){ue("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(n){this.mlContext.writeTensor(this.mlTensor,n)}async read(n){if(this.fallbackDataType){let a=await this.mlContext.readTensor(this.mlTensor),l=zr(new Uint8Array(a),this.dataType);if(n){(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).set(l);return}else return l.buffer}else return n?this.mlContext.readTensor(this.mlTensor,n):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(n,a,l){return this.mlContext===n&&this.dataType===a&&this.tensorShape.length===l.length&&this.tensorShape.every((f,u)=>f===l[u])}setIsDataConverted(n){this.isDataConverted=n}},Xr=class{constructor(n,a){this.tensorManager=n,this.wrapper=a}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(n,a,l,f){let u=this.tensorManager.getMLContext(n),i;if(!u.opSupportLimits().input.dataTypes.includes(a)){if(i=ya.get(a),!i||!u.opSupportLimits().input.dataTypes.includes(i))throw new Error(`WebNN backend does not support data type: ${a}`);ue("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${a} to ${i}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(u,a,l))return this.wrapper.tensor;if(f){if(this.wrapper.byteLength!==qr(a,l))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let p=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(n,a,l,p,!0,!0,i),f&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(n){let a=n;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")a=nn(n,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(n.byteLength===this.wrapper.byteLength){this.wrapper.write(a);return}else ue("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(a):this.activeUpload=new Uint8Array(a)}async download(n){var a,l;if(this.activeUpload){let f=(a=this.wrapper)!=null&&a.isDataConverted?zr(this.activeUpload,(l=this.wrapper)==null?void 0:l.type):this.activeUpload;if(n){n instanceof ArrayBuffer?new Uint8Array(n).set(f):new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(f);return}else return f.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return n?this.wrapper.read(n):this.wrapper.read()}},ma=class{constructor(n){this.backend=n,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(n){let a=this.backend.getMLContext(n);if(!a)throw new Error("MLContext not found for session.");return a}reserveTensorId(){let n=Hr();return this.tensorTrackersById.set(n,new Xr(this)),n}releaseTensorId(n){let a=this.tensorTrackersById.get(n);a&&(this.tensorTrackersById.delete(n),a.tensorWrapper&&this.releaseTensor(a.tensorWrapper))}async ensureTensor(n,a,l,f,u){ue("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${a}, dataType: ${l}, shape: ${f}, copyOld: ${u}}`);let i=this.tensorTrackersById.get(a);if(!i)throw new Error("Tensor not found.");return i.ensureTensor(n,l,f,u)}upload(n,a){let l=this.tensorTrackersById.get(n);if(!l)throw new Error("Tensor not found.");l.upload(a)}async download(n,a){ue("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${n}, dstBuffer: ${a==null?void 0:a.byteLength}}`);let l=this.tensorTrackersById.get(n);if(!l)throw new Error("Tensor not found.");return l.download(a)}releaseTensorsForSession(n){for(let a of this.freeTensors)a.sessionId===n&&a.destroy();this.freeTensors=this.freeTensors.filter(a=>a.sessionId!==n)}registerTensor(n,a,l,f){let u=this.getMLContext(n),i=Hr(),p=new Zr({sessionId:n,context:u,tensor:a,dataType:l,shape:f});return this.tensorTrackersById.set(i,new Xr(this,p)),this.externalTensors.add(p),i}async getCachedTensor(n,a,l,f,u,i,p){let h=this.getMLContext(n);for(let[y,v]of this.freeTensors.entries())if(v.canReuseTensor(h,a,l)){ue("verbose",()=>`[WebNN] Reusing tensor {dataType: ${a}, ${p?`fallbackDataType: ${p},`:""} shape: ${l}`);let C=this.freeTensors.splice(y,1)[0];return C.sessionId=n,C}ue("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${a}, ${p?`fallbackDataType: ${p},`:""} shape: ${l}}`);let m=await h.createTensor({dataType:p??a,shape:l,dimensions:l,usage:f,writable:u,readable:i});return new Zr({sessionId:n,context:h,tensor:m,dataType:a,shape:l,fallbackDataType:p})}releaseTensor(n){this.externalTensors.has(n)&&this.externalTensors.delete(n),this.freeTensors.push(n)}},to=(...n)=>new ma(...n)}),ro={};Rt(ro,{WebNNBackend:()=>no});var Ot,ga,no,Kl=$(()=>{gt(),ot(),Jl(),Ql(),eo(),Ot=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),ga=(n,a)=>{if(n===a)return!0;if(n===void 0||a===void 0)return!1;let l=Object.keys(n).sort(),f=Object.keys(a).sort();return l.length===f.length&&l.every((u,i)=>u===f[i]&&n[u]===a[u])},no=class{constructor(n){this.tensorManager=to(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Ka(n.logLevel,!!n.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(n){ue("verbose",()=>`[WebNN] onRunStart {sessionId: ${n}}`),this.activeSessionId=n}onRunEnd(n){ue("verbose",()=>`[WebNN] onRunEnd {sessionId: ${n}}`);let a=this.temporarySessionTensorIds.get(n);if(a){for(let l of a)ue("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${l}}`),this.tensorManager.releaseTensorId(l);this.temporarySessionTensorIds.delete(n),this.activeSessionId=void 0}}async createMLContext(n){if(n instanceof GPUDevice){let l=this.mlContextCache.findIndex(f=>f.gpuDevice===n);if(l!==-1)return this.mlContextCache[l].mlContext;{let f=await navigator.ml.createContext(n);return this.mlContextCache.push({gpuDevice:n,mlContext:f}),f}}else if(n===void 0){let l=this.mlContextCache.findIndex(f=>f.options===void 0&&f.gpuDevice===void 0);if(l!==-1)return this.mlContextCache[l].mlContext;{let f=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:f}),f}}let a=this.mlContextCache.findIndex(l=>ga(l.options,n));if(a!==-1)return this.mlContextCache[a].mlContext;{let l=await navigator.ml.createContext(n);return this.mlContextCache.push({options:n,mlContext:l}),l}}registerMLContext(n,a){this.mlContextBySessionId.set(n,a);let l=this.sessionIdsByMLContext.get(a);l||(l=new Set,this.sessionIdsByMLContext.set(a,l)),l.add(n),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(n,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(n,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(n){this.sessionGraphInputs.delete(n),this.sessionGraphOutputs.delete(n);let a=this.mlContextBySessionId.get(n);if(!a)return;this.tensorManager.releaseTensorsForSession(n),this.mlContextBySessionId.delete(n);let l=this.sessionIdsByMLContext.get(a);if(l.delete(n),l.size===0){this.sessionIdsByMLContext.delete(a);let f=this.mlContextCache.findIndex(u=>u.mlContext===a);f!==-1&&this.mlContextCache.splice(f,1)}}getMLContext(n){return this.mlContextBySessionId.get(n)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(n){ue("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n)}async ensureTensor(n,a,l,f,u){let i=Ot.get(l);if(!i)throw new Error(`Unsupported ONNX data type: ${l}`);return this.tensorManager.ensureTensor(n??this.currentSessionId,a,i,f,u)}async createTemporaryTensor(n,a,l){ue("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${a}, shape: ${l}}`);let f=Ot.get(a);if(!f)throw new Error(`Unsupported ONNX data type: ${a}`);let u=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(n,u,f,l,!1);let i=this.temporarySessionTensorIds.get(n);return i?i.push(u):this.temporarySessionTensorIds.set(n,[u]),u}uploadTensor(n,a){if(!V().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");ue("verbose",()=>`[WebNN] uploadTensor {tensorId: ${n}, data: ${a.byteLength}}`),this.tensorManager.upload(n,a)}async downloadTensor(n,a){return this.tensorManager.download(n,a)}createMLTensorDownloader(n,a){return async()=>{let l=await this.tensorManager.download(n);return Qa(l,a)}}registerMLTensor(n,a,l,f){let u=Ot.get(l);if(!u)throw new Error(`Unsupported ONNX data type: ${l}`);let i=this.tensorManager.registerTensor(n,a,u,f);return ue("verbose",()=>`[WebNN] registerMLTensor {tensor: ${a}, dataType: ${u}, dimensions: ${f}} -> {tensorId: ${i}}`),i}registerMLConstant(n,a,l,f,u,i,p=!1){if(!i)throw new Error("External mounted files are not available.");let h=n;n.startsWith("./")&&(h=n.substring(2));let m=i.get(h);if(!m)throw new Error(`File with name ${h} not found in preloaded files.`);if(a+l>m.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let y=m.slice(a,a+l).buffer,v;switch(u.dataType){case"float32":v=new Float32Array(y);break;case"float16":v=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(y):new Uint16Array(y);break;case"int32":v=new Int32Array(y);break;case"uint32":v=new Uint32Array(y);break;case"int64":if(p){let C=nn(new Uint8Array(y),"int64");v=new Int32Array(C.buffer),u.dataType="int32"}else v=new BigInt64Array(y);break;case"uint64":v=new BigUint64Array(y);break;case"int8":v=new Int8Array(y);break;case"int4":case"uint4":case"uint8":v=new Uint8Array(y);break;default:throw new Error(`Unsupported data type: ${u.dataType} in creating WebNN Constant from external data.`)}return ue("verbose",()=>`[WebNN] registerMLConstant {dataType: ${u.dataType}, shape: ${u.shape}}} ${p?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),f.constant(u,v)}registerGraphInput(n){this.temporaryGraphInputs.push(n)}registerGraphOutput(n){this.temporaryGraphOutputs.push(n)}isGraphInput(n,a){let l=this.sessionGraphInputs.get(n);return l?l.includes(a):!1}isGraphOutput(n,a){let l=this.sessionGraphOutputs.get(n);return l?l.includes(a):!1}isGraphInputOutputTypeSupported(n,a,l=!0){let f=this.mlContextBySessionId.get(n),u=Ot.get(rt(a));return typeof u>"u"?!1:l?!!(f!=null&&f.opSupportLimits().input.dataTypes.includes(u)):!!(f!=null&&f.opSupportLimits().output.dataTypes.includes(u))}flush(){}}}),wa,mn,gn,Ze,ba,Yr,rr,wn,bn,Jr,vn,Cn,Tn,io=$(()=>{at(),Xl(),Yl(),gt(),ot(),pn(),Ja(),wa=(n,a)=>{V()._OrtInit(n,a)!==0&&F("Can't initialize onnxruntime.")},mn=async n=>{wa(n.wasm.numThreads,tr(n.logLevel))},gn=async(n,a)=>{var f,u;(u=(f=V()).asyncInit)==null||u.call(f);let l=n.webgpu.adapter;if(a==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(l){if(typeof l.limits!="object"||typeof l.features!="object"||typeof l.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=n.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let p=n.webgpu.forceFallbackAdapter;if(p!==void 0&&typeof p!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${p}"`);if(l=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:p}),!l)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(a==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(a==="webgpu"&&V().webgpuInit(i=>{n.webgpu.device=i}),a==="webnn"){let i=new(Kl(),Kt(ro)).WebNNBackend(n);V().webnnInit([i,()=>i.reserveTensorId(),p=>i.releaseTensorId(p),async(p,h,m,y,v)=>i.ensureTensor(p,h,m,y,v),(p,h)=>{i.uploadTensor(p,h)},async(p,h)=>i.downloadTensor(p,h),(p,h)=>i.registerMLContext(p,h),!!n.trace])}},Ze=new Map,ba=n=>{let a=V(),l=a.stackSave();try{let f=a.PTR_SIZE,u=a.stackAlloc(2*f);a._OrtGetInputOutputCount(n,u,u+f)!==0&&F("Can't get session input/output count.");let i=f===4?"i32":"i64";return[Number(a.getValue(u,i)),Number(a.getValue(u+f,i))]}finally{a.stackRestore(l)}},Yr=(n,a)=>{let l=V(),f=l.stackSave(),u=0;try{let i=l.PTR_SIZE,p=l.stackAlloc(2*i);l._OrtGetInputOutputMetadata(n,a,p,p+i)!==0&&F("Can't get session input/output metadata.");let h=Number(l.getValue(p,"*"));u=Number(l.getValue(p+i,"*"));let m=l.HEAP32[u/4];if(m===0)return[h,0];let y=l.HEAPU32[u/4+1],v=[];for(let C=0;C<y;C++){let E=Number(l.getValue(u+8+C*i,"*"));v.push(E!==0?l.UTF8ToString(E):Number(l.getValue(u+8+(C+y)*i,"*")))}return[h,m,v]}finally{l.stackRestore(f),u!==0&&l._OrtFree(u)}},rr=n=>{let a=V(),l=a._malloc(n.byteLength);if(l===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${n.byteLength}.`);return a.HEAPU8.set(n,l),[l,n.byteLength]},wn=async(n,a)=>{var C,E,O,M;let l,f,u=V();Array.isArray(n)?[l,f]=n:n.buffer===u.HEAPU8.buffer?[l,f]=[n.byteOffset,n.byteLength]:[l,f]=rr(n);let i=0,p=0,h=0,m=[],y=[],v=[];try{if([p,m]=await Ya(a),(a==null?void 0:a.externalData)&&u.mountExternalData){let W=[];for(let k of a.externalData){let se=typeof k=="string"?k:k.path;W.push(yn(typeof k=="string"?k:k.data).then(me=>{u.mountExternalData(se,me)}))}await Promise.all(W)}for(let W of(a==null?void 0:a.executionProviders)??[])if((typeof W=="string"?W:W.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof W!="string"){let k=W,se=k==null?void 0:k.context,me=k==null?void 0:k.gpuDevice,H=k==null?void 0:k.deviceType,oe=k==null?void 0:k.powerPreference;se?u.currentContext=se:me?u.currentContext=await u.webnnCreateMLContext(me):u.currentContext=await u.webnnCreateMLContext({deviceType:H,powerPreference:oe})}else u.currentContext=await u.webnnCreateMLContext();break}i=await u._OrtCreateSession(l,f,p),(C=u.webgpuOnCreateSession)==null||C.call(u,i),i===0&&F("Can't create a session."),(E=u.jsepOnCreateSession)==null||E.call(u),u.currentContext&&(u.webnnRegisterMLContext(i,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[j,N]=ba(i),R=!!(a!=null&&a.enableGraphCapture),S=[],z=[],q=[],Q=[],ye=[];for(let W=0;W<j;W++){let[k,se,me]=Yr(i,W);k===0&&F("Can't get an input name."),y.push(k);let H=u.UTF8ToString(k);S.push(H),q.push(se===0?{name:H,isTensor:!1}:{name:H,isTensor:!0,type:Qt(se),shape:me})}for(let W=0;W<N;W++){let[k,se,me]=Yr(i,W+j);k===0&&F("Can't get an output name."),v.push(k);let H=u.UTF8ToString(k);z.push(H),Q.push(se===0?{name:H,isTensor:!1}:{name:H,isTensor:!0,type:Qt(se),shape:me});{if(R&&(a==null?void 0:a.preferredOutputLocation)===void 0){ye.push("gpu-buffer");continue}let oe=typeof(a==null?void 0:a.preferredOutputLocation)=="string"?a.preferredOutputLocation:((O=a==null?void 0:a.preferredOutputLocation)==null?void 0:O[H])??"cpu",Fe=u.webnnIsGraphOutput;if(oe==="cpu"&&Fe&&Fe(i,H)){ye.push("ml-tensor-cpu-output");continue}if(oe!=="cpu"&&oe!=="cpu-pinned"&&oe!=="gpu-buffer"&&oe!=="ml-tensor")throw new Error(`Not supported preferred output location: ${oe}.`);if(R&&oe!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${oe}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);ye.push(oe)}}let Ae=null;return ye.some(W=>W==="gpu-buffer"||W==="ml-tensor"||W==="ml-tensor-cpu-output")&&(h=u._OrtCreateBinding(i),h===0&&F("Can't create IO binding."),Ae={handle:h,outputPreferredLocations:ye,outputPreferredLocationsEncoded:ye.map(W=>W==="ml-tensor-cpu-output"?"ml-tensor":W).map(W=>rn(W))}),Ze.set(i,[i,y,v,Ae,R,!1]),[i,S,z,q,Q]}catch(j){throw y.forEach(N=>u._OrtFree(N)),v.forEach(N=>u._OrtFree(N)),h!==0&&u._OrtReleaseBinding(h)!==0&&F("Can't release IO binding."),i!==0&&u._OrtReleaseSession(i)!==0&&F("Can't release session."),j}finally{u._free(l),p!==0&&u._OrtReleaseSessionOptions(p)!==0&&F("Can't release session options."),m.forEach(j=>u._free(j)),(M=u.unmountExternalData)==null||M.call(u)}},bn=n=>{var m,y,v;let a=V(),l=Ze.get(n);if(!l)throw new Error(`cannot release session. invalid session id: ${n}`);let[f,u,i,p,h]=l;p&&(h&&a._OrtClearBoundOutputs(p.handle)!==0&&F("Can't clear bound outputs."),a._OrtReleaseBinding(p.handle)!==0&&F("Can't release IO binding.")),(m=a.jsepOnReleaseSession)==null||m.call(a,n),(y=a.webnnOnReleaseSession)==null||y.call(a,n),(v=a.webgpuOnReleaseSession)==null||v.call(a,n),u.forEach(C=>a._OrtFree(C)),i.forEach(C=>a._OrtFree(C)),a._OrtReleaseSession(f)!==0&&F("Can't release session."),Ze.delete(n)},Jr=async(n,a,l,f,u,i,p=!1)=>{if(!n){a.push(0);return}let h=V(),m=h.PTR_SIZE,y=n[0],v=n[1],C=n[3],E=C,O,M;if(y==="string"&&(C==="gpu-buffer"||C==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(p&&C!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${i} when enableGraphCapture is true.`);if(C==="gpu-buffer"){let R=n[2].gpuBuffer;M=ct(rt(y),v);{let S=h.webgpuRegisterBuffer;if(!S)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');O=S(R,f)}}else if(C==="ml-tensor"){let R=n[2].mlTensor;M=ct(rt(y),v);let S=h.webnnRegisterMLTensor;if(!S)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');O=S(f,R,rt(y),v)}else{let R=n[2];if(Array.isArray(R)){M=m*R.length,O=h._malloc(M),l.push(O);for(let S=0;S<R.length;S++){if(typeof R[S]!="string")throw new TypeError(`tensor data at index ${S} is not a string`);h.setValue(O+S*m,ve(R[S],l),"*")}}else{let S=h.webnnIsGraphInput,z=h.webnnIsGraphOutput;if(y!=="string"&&S&&z){let q=h.UTF8ToString(u);if(S(f,q)||z(f,q)){let Q=rt(y);M=ct(Q,v),E="ml-tensor";let ye=h.webnnCreateTemporaryTensor,Ae=h.webnnUploadTensor;if(!ye||!Ae)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let W=await ye(f,Q,v);Ae(W,new Uint8Array(R.buffer,R.byteOffset,R.byteLength)),O=W}else M=R.byteLength,O=h._malloc(M),l.push(O),h.HEAPU8.set(new Uint8Array(R.buffer,R.byteOffset,M),O)}else M=R.byteLength,O=h._malloc(M),l.push(O),h.HEAPU8.set(new Uint8Array(R.buffer,R.byteOffset,M),O)}}let j=h.stackSave(),N=h.stackAlloc(4*v.length);try{v.forEach((S,z)=>h.setValue(N+z*m,S,m===4?"i32":"i64"));let R=h._OrtCreateTensor(rt(y),O,M,N,v.length,rn(E));R===0&&F(`Can't create tensor for input/output. session=${f}, index=${i}.`),a.push(R)}finally{h.stackRestore(j)}},vn=async(n,a,l,f,u,i)=>{var me,H,oe,Fe;let p=V(),h=p.PTR_SIZE,m=Ze.get(n);if(!m)throw new Error(`cannot run inference. invalid session id: ${n}`);let y=m[0],v=m[1],C=m[2],E=m[3],O=m[4],M=m[5],j=a.length,N=f.length,R=0,S=[],z=[],q=[],Q=[],ye=p.stackSave(),Ae=p.stackAlloc(j*h),W=p.stackAlloc(j*h),k=p.stackAlloc(N*h),se=p.stackAlloc(N*h);try{[R,S]=Xa(i),nt("wasm prepareInputOutputTensor");for(let L=0;L<j;L++)await Jr(l[L],z,Q,n,v[a[L]],a[L],O);for(let L=0;L<N;L++)await Jr(u[L],q,Q,n,C[f[L]],j+f[L],O);it("wasm prepareInputOutputTensor");for(let L=0;L<j;L++)p.setValue(Ae+L*h,z[L],"*"),p.setValue(W+L*h,v[a[L]],"*");for(let L=0;L<N;L++)p.setValue(k+L*h,q[L],"*"),p.setValue(se+L*h,C[f[L]],"*");if(E&&!M){let{handle:L,outputPreferredLocations:J,outputPreferredLocationsEncoded:Ie}=E;if(v.length!==j)throw new Error(`input count from feeds (${j}) is expected to be always equal to model's input count (${v.length}).`);nt("wasm bindInputsOutputs");for(let Z=0;Z<j;Z++){let fe=a[Z];await p._OrtBindInput(L,v[fe],z[Z])!==0&&F(`Can't bind input[${Z}] for session=${n}.`)}for(let Z=0;Z<N;Z++){let fe=f[Z];(me=u[Z])!=null&&me[3]?p._OrtBindOutput(L,C[fe],q[Z],0)!==0&&F(`Can't bind pre-allocated output[${Z}] for session=${n}.`):p._OrtBindOutput(L,C[fe],0,Ie[fe])!==0&&F(`Can't bind output[${Z}] to ${J[Z]} for session=${n}.`)}it("wasm bindInputsOutputs"),Ze.set(n,[y,v,C,E,O,!0])}(H=p.jsepOnRunStart)==null||H.call(p,y),(oe=p.webnnOnRunStart)==null||oe.call(p,y);let ee;E?ee=await p._OrtRunWithBinding(y,E.handle,N,k,R):ee=await p._OrtRun(y,W,Ae,j,se,N,k,R),ee!==0&&F("failed to call OrtRun().");let Oe=[],Mt=[];nt("wasm ProcessOutputTensor");for(let L=0;L<N;L++){let J=Number(p.getValue(k+L*h,"*"));if(J===q[L]){Oe.push(u[L]);continue}let Ie=p.stackSave(),Z=p.stackAlloc(4*h),fe=!1,P,re=0;try{p._OrtGetTensorData(J,Z,Z+h,Z+2*h,Z+3*h)!==0&&F(`Can't access output tensor data on index ${L}.`);let Ye=h===4?"i32":"i64",I=Number(p.getValue(Z,Ye));re=p.getValue(Z+h,"*");let x=p.getValue(Z+h*2,"*"),wt=Number(p.getValue(Z+h*3,Ye)),le=[];for(let ne=0;ne<wt;ne++)le.push(Number(p.getValue(x+ne*h,Ye)));p._OrtFree(x)!==0&&F("Can't free memory for tensor dims.");let Te=le.reduce((ne,X)=>ne*X,1);P=Qt(I);let ie=E==null?void 0:E.outputPreferredLocations[f[L]];if(P==="string"){if(ie==="gpu-buffer"||ie==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let ne=[];for(let X=0;X<Te;X++){let de=p.getValue(re+X*h,"*"),je=p.getValue(re+(X+1)*h,"*"),st=X===Te-1?void 0:je-de;ne.push(p.UTF8ToString(de,st))}Oe.push([P,le,ne,"cpu"])}else if(ie==="gpu-buffer"&&Te>0){let ne=p.webgpuGetBuffer;if(!ne)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let X=ne(re),de=ct(I,Te);if(de===void 0||!cn(P))throw new Error(`Unsupported data type: ${P}`);fe=!0;{p.webgpuRegisterBuffer(X,n,re);let je=p.webgpuCreateDownloader(X,de,n);Oe.push([P,le,{gpuBuffer:X,download:async()=>{let st=await je();return new(Bt(P))(st)},dispose:()=>{p._OrtReleaseTensor(J)!==0&&F("Can't release tensor.")}},"gpu-buffer"])}}else if(ie==="ml-tensor"&&Te>0){let ne=p.webnnEnsureTensor,X=p.webnnIsGraphInputOutputTypeSupported;if(!ne||!X)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ct(I,Te)===void 0||!hn(P))throw new Error(`Unsupported data type: ${P}`);if(!X(n,P,!1))throw new Error(`preferredLocation "ml-tensor" for ${P} output is not supported by current WebNN Context.`);let de=await ne(n,re,I,le,!1);fe=!0,Oe.push([P,le,{mlTensor:de,download:p.webnnCreateMLTensorDownloader(re,P),dispose:()=>{p.webnnReleaseTensorId(re),p._OrtReleaseTensor(J)}},"ml-tensor"])}else if(ie==="ml-tensor-cpu-output"&&Te>0){let ne=p.webnnCreateMLTensorDownloader(re,P)(),X=Oe.length;fe=!0,Mt.push((async()=>{let de=[X,await ne];return p.webnnReleaseTensorId(re),p._OrtReleaseTensor(J),de})()),Oe.push([P,le,[],"cpu"])}else{let ne=Bt(P),X=new ne(Te);new Uint8Array(X.buffer,X.byteOffset,X.byteLength).set(p.HEAPU8.subarray(re,re+X.byteLength)),Oe.push([P,le,X,"cpu"])}}finally{p.stackRestore(Ie),P==="string"&&re&&p._free(re),fe||p._OrtReleaseTensor(J)}}E&&!O&&(p._OrtClearBoundOutputs(E.handle)!==0&&F("Can't clear bound outputs."),Ze.set(n,[y,v,C,E,O,!1]));for(let[L,J]of await Promise.all(Mt))Oe[L][2]=J;return it("wasm ProcessOutputTensor"),Oe}finally{(Fe=p.webnnOnRunEnd)==null||Fe.call(p,y),p.stackRestore(ye),l.forEach(ee=>{ee&&ee[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(ee[2].gpuBuffer)}),u.forEach(ee=>{ee&&ee[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(ee[2].gpuBuffer)}),z.forEach(ee=>p._OrtReleaseTensor(ee)),q.forEach(ee=>p._OrtReleaseTensor(ee)),Q.forEach(ee=>p._free(ee)),R!==0&&p._OrtReleaseRunOptions(R),S.forEach(ee=>p._free(ee))}},Cn=n=>{let a=V(),l=Ze.get(n);if(!l)throw new Error("invalid session id");let f=l[0],u=a._OrtEndProfiling(f);u===0&&F("Can't get an profile file name."),a._OrtFree(u)},Tn=n=>{let a=[];for(let l of n){let f=l[2];!Array.isArray(f)&&"buffer"in f&&a.push(f.buffer)}return a}}),Xe,ge,pt,It,St,Yt,Qr,Jt,Ke,et,va,ao,oo,so,lo,uo,fo,po,co=$(()=>{at(),io(),ot(),fn(),Xe=()=>!!K.wasm.proxy&&typeof document<"u",pt=!1,It=!1,St=!1,Jt=new Map,Ke=(n,a)=>{let l=Jt.get(n);l?l.push(a):Jt.set(n,[a])},et=()=>{if(pt||!It||St||!ge)throw new Error("worker not ready")},va=n=>{switch(n.data.type){case"init-wasm":pt=!1,n.data.err?(St=!0,Qr[1](n.data.err)):(It=!0,Qr[0]()),Yt&&(URL.revokeObjectURL(Yt),Yt=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let a=Jt.get(n.data.type);n.data.err?a.shift()[1](n.data.err):a.shift()[0](n.data.out);break}}},ao=async()=>{if(!It){if(pt)throw new Error("multiple calls to 'initWasm()' detected.");if(St)throw new Error("previous call to 'initWasm()' failed.");if(pt=!0,Xe())return new Promise((n,a)=>{ge==null||ge.terminate(),qa().then(([l,f])=>{try{ge=f,ge.onerror=i=>a(i),ge.onmessage=va,Qr=[n,a];let u={type:"init-wasm",in:K};!u.in.wasm.wasmPaths&&(l||tn)&&(u.in.wasm.wasmPaths={wasm:new URL("/Parallaxer/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",import.meta.url).href}),ge.postMessage(u),Yt=l}catch(u){a(u)}},a)});try{await dn(K.wasm),await mn(K),It=!0}catch(n){throw St=!0,n}finally{pt=!1}}},oo=async n=>{if(Xe())return et(),new Promise((a,l)=>{Ke("init-ep",[a,l]);let f={type:"init-ep",in:{epName:n,env:K}};ge.postMessage(f)});await gn(K,n)},so=async n=>Xe()?(et(),new Promise((a,l)=>{Ke("copy-from",[a,l]);let f={type:"copy-from",in:{buffer:n}};ge.postMessage(f,[n.buffer])})):rr(n),lo=async(n,a)=>{if(Xe()){if(a!=null&&a.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return et(),new Promise((l,f)=>{Ke("create",[l,f]);let u={type:"create",in:{model:n,options:{...a}}},i=[];n instanceof Uint8Array&&i.push(n.buffer),ge.postMessage(u,i)})}else return wn(n,a)},uo=async n=>{if(Xe())return et(),new Promise((a,l)=>{Ke("release",[a,l]);let f={type:"release",in:n};ge.postMessage(f)});bn(n)},fo=async(n,a,l,f,u,i)=>{if(Xe()){if(l.some(p=>p[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(p=>p))throw new Error("pre-allocated output tensor is not supported for proxy.");return et(),new Promise((p,h)=>{Ke("run",[p,h]);let m=l,y={type:"run",in:{sessionId:n,inputIndices:a,inputs:m,outputIndices:f,options:i}};ge.postMessage(y,Tn(m))})}else return vn(n,a,l,f,u,i)},po=async n=>{if(Xe())return et(),new Promise((a,l)=>{Ke("end-profiling",[a,l]);let f={type:"end-profiling",in:n};ge.postMessage(f)});Cn(n)}}),Kr,Ca,ho,eu=$(()=>{at(),co(),gt(),un(),Ja(),Kr=(n,a)=>{switch(n.location){case"cpu":return[n.type,n.dims,n.data,"cpu"];case"gpu-buffer":return[n.type,n.dims,{gpuBuffer:n.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[n.type,n.dims,{mlTensor:n.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${n.location} for ${a()}`)}},Ca=n=>{switch(n[3]){case"cpu":return new Le(n[0],n[2],n[1]);case"gpu-buffer":{let a=n[0];if(!cn(a))throw new Error(`not supported data type: ${a} for deserializing GPU tensor`);let{gpuBuffer:l,download:f,dispose:u}=n[2];return Le.fromGpuBuffer(l,{dataType:a,dims:n[1],download:f,dispose:u})}case"ml-tensor":{let a=n[0];if(!hn(a))throw new Error(`not supported data type: ${a} for deserializing MLTensor tensor`);let{mlTensor:l,download:f,dispose:u}=n[2];return Le.fromMLTensor(l,{dataType:a,dims:n[1],download:f,dispose:u})}default:throw new Error(`invalid data location: ${n[3]}`)}},ho=class{async fetchModelAndCopyToWasmMemory(n){return so(await yn(n))}async loadModel(n,a){yt();let l;typeof n=="string"?l=await this.fetchModelAndCopyToWasmMemory(n):l=n,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await lo(l,a),mt()}async dispose(){return uo(this.sessionId)}async run(n,a,l){yt();let f=[],u=[];Object.entries(n).forEach(C=>{let E=C[0],O=C[1],M=this.inputNames.indexOf(E);if(M===-1)throw new Error(`invalid input '${E}'`);f.push(O),u.push(M)});let i=[],p=[];Object.entries(a).forEach(C=>{let E=C[0],O=C[1],M=this.outputNames.indexOf(E);if(M===-1)throw new Error(`invalid output '${E}'`);i.push(O),p.push(M)});let h=f.map((C,E)=>Kr(C,()=>`input "${this.inputNames[u[E]]}"`)),m=i.map((C,E)=>C?Kr(C,()=>`output "${this.outputNames[p[E]]}"`):null),y=await fo(this.sessionId,u,h,p,m,l),v={};for(let C=0;C<y.length;C++)v[this.outputNames[p[C]]]=i[C]??Ca(y[C]);return mt(),v}startProfiling(){}endProfiling(){po(this.sessionId)}}}),yo={};Rt(yo,{OnnxruntimeWebAssemblyBackend:()=>on,initializeFlags:()=>an,wasmBackend:()=>mo});var an,on,mo,tu=$(()=>{at(),co(),eu(),an=()=>{(typeof K.wasm.initTimeout!="number"||K.wasm.initTimeout<0)&&(K.wasm.initTimeout=0);let n=K.wasm.simd;if(typeof n!="boolean"&&n!==void 0&&n!=="fixed"&&n!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${n}". Reset it to \`false\` and ignore SIMD feature checking.`),K.wasm.simd=!1),typeof K.wasm.proxy!="boolean"&&(K.wasm.proxy=!1),typeof K.wasm.trace!="boolean"&&(K.wasm.trace=!1),typeof K.wasm.numThreads!="number"||!Number.isInteger(K.wasm.numThreads)||K.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)K.wasm.numThreads=1;else{let a=typeof navigator>"u"?Rl("node:os").cpus().length:navigator.hardwareConcurrency;K.wasm.numThreads=Math.min(4,Math.ceil((a||1)/2))}},on=class{async init(n){an(),await ao(),await oo(n)}async createInferenceSessionHandler(n,a){let l=new ho;return await l.loadModel(n,a),l}},mo=new on});at();at();at();var ru="1.23.2",iu=Wa;{let n=(tu(),Kt(yo)).wasmBackend;ht("webgpu",n,5),ht("webnn",n,5),ht("cpu",n,10),ht("wasm",n,10)}Object.defineProperty(K.versions,"web",{value:ru,enumerable:!0});export{Na as InferenceSession,en as TRACE,nt as TRACE_EVENT_BEGIN,it as TRACE_EVENT_END,yt as TRACE_FUNC_BEGIN,mt as TRACE_FUNC_END,Le as Tensor,iu as default,K as env,ht as registerBackend};
